const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/MiniMap.hs6gm6as.js","_astro/index.Dz-RgX_1.js","_astro/index.9Hbp8J6b.css"])))=>i.map(i=>d[i]);
import{r as ot,a as b,R as ae}from"./index.Dz-RgX_1.js";const it="modulepreload",lt=function(e){return"/"+e},qe={},ct=function(t,r,c){let u=Promise.resolve();if(r&&r.length>0){let a=function(n){return Promise.all(n.map(o=>Promise.resolve(o).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),p=d?.nonce||d?.getAttribute("nonce");u=a(r.map(n=>{if(n=lt(n),n in qe)return;qe[n]=!0;const o=n.endsWith(".css"),i=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${i}`))return;const m=document.createElement("link");if(m.rel=o?"stylesheet":it,o||(m.as="script"),m.crossOrigin="",m.href=n,p&&m.setAttribute("nonce",p),document.head.appendChild(m),o)return new Promise((f,y)=>{m.addEventListener("load",f),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${n}`)))})}))}function l(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return u.then(a=>{for(const d of a||[])d.status==="rejected"&&l(d.reason);return t().catch(l)})};var ke={exports:{}},xe={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ze;function dt(){if(ze)return xe;ze=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(c,u,l){var a=null;if(l!==void 0&&(a=""+l),u.key!==void 0&&(a=""+u.key),"key"in u){l={};for(var d in u)d!=="key"&&(l[d]=u[d])}else l=u;return u=l.ref,{$$typeof:e,type:c,key:a,ref:u!==void 0?u:null,props:l}}return xe.Fragment=t,xe.jsx=r,xe.jsxs=r,xe}var Ue;function ut(){return Ue||(Ue=1,ke.exports=dt()),ke.exports}var s=ut(),Ve=ot();const ie=11102230246251565e-32,Y=134217729,mt=(3+8*ie)*ie;function Ee(e,t,r,c,u){let l,a,d,p,n=t[0],o=c[0],i=0,m=0;o>n==o>-n?(l=n,n=t[++i]):(l=o,o=c[++m]);let f=0;if(i<e&&m<r)for(o>n==o>-n?(a=n+l,d=l-(a-n),n=t[++i]):(a=o+l,d=l-(a-o),o=c[++m]),l=a,d!==0&&(u[f++]=d);i<e&&m<r;)o>n==o>-n?(a=l+n,p=a-l,d=l-(a-p)+(n-p),n=t[++i]):(a=l+o,p=a-l,d=l-(a-p)+(o-p),o=c[++m]),l=a,d!==0&&(u[f++]=d);for(;i<e;)a=l+n,p=a-l,d=l-(a-p)+(n-p),n=t[++i],l=a,d!==0&&(u[f++]=d);for(;m<r;)a=l+o,p=a-l,d=l-(a-p)+(o-p),o=c[++m],l=a,d!==0&&(u[f++]=d);return(l!==0||f===0)&&(u[f++]=l),f}function ft(e,t){let r=t[0];for(let c=1;c<e;c++)r+=t[c];return r}function we(e){return new Float64Array(e)}const pt=(3+16*ie)*ie,ht=(2+12*ie)*ie,gt=(9+64*ie)*ie*ie,me=we(4),We=we(8),Je=we(12),Ge=we(16),Q=we(4);function xt(e,t,r,c,u,l,a){let d,p,n,o,i,m,f,y,h,j,g,_,L,k,E,P,T,C;const q=e-u,I=r-u,D=t-l,F=c-l;k=q*F,m=Y*q,f=m-(m-q),y=q-f,m=Y*F,h=m-(m-F),j=F-h,E=y*j-(k-f*h-y*h-f*j),P=D*I,m=Y*D,f=m-(m-D),y=D-f,m=Y*I,h=m-(m-I),j=I-h,T=y*j-(P-f*h-y*h-f*j),g=E-T,i=E-g,me[0]=E-(g+i)+(i-T),_=k+g,i=_-k,L=k-(_-i)+(g-i),g=L-P,i=L-g,me[1]=L-(g+i)+(i-P),C=_+g,i=C-_,me[2]=_-(C-i)+(g-i),me[3]=C;let z=ft(4,me),K=ht*a;if(z>=K||-z>=K||(i=e-q,d=e-(q+i)+(i-u),i=r-I,n=r-(I+i)+(i-u),i=t-D,p=t-(D+i)+(i-l),i=c-F,o=c-(F+i)+(i-l),d===0&&p===0&&n===0&&o===0)||(K=gt*a+mt*Math.abs(z),z+=q*o+F*d-(D*n+I*p),z>=K||-z>=K))return z;k=d*F,m=Y*d,f=m-(m-d),y=d-f,m=Y*F,h=m-(m-F),j=F-h,E=y*j-(k-f*h-y*h-f*j),P=p*I,m=Y*p,f=m-(m-p),y=p-f,m=Y*I,h=m-(m-I),j=I-h,T=y*j-(P-f*h-y*h-f*j),g=E-T,i=E-g,Q[0]=E-(g+i)+(i-T),_=k+g,i=_-k,L=k-(_-i)+(g-i),g=L-P,i=L-g,Q[1]=L-(g+i)+(i-P),C=_+g,i=C-_,Q[2]=_-(C-i)+(g-i),Q[3]=C;const ce=Ee(4,me,4,Q,We);k=q*o,m=Y*q,f=m-(m-q),y=q-f,m=Y*o,h=m-(m-o),j=o-h,E=y*j-(k-f*h-y*h-f*j),P=D*n,m=Y*D,f=m-(m-D),y=D-f,m=Y*n,h=m-(m-n),j=n-h,T=y*j-(P-f*h-y*h-f*j),g=E-T,i=E-g,Q[0]=E-(g+i)+(i-T),_=k+g,i=_-k,L=k-(_-i)+(g-i),g=L-P,i=L-g,Q[1]=L-(g+i)+(i-P),C=_+g,i=C-_,Q[2]=_-(C-i)+(g-i),Q[3]=C;const se=Ee(ce,We,4,Q,Je);k=d*o,m=Y*d,f=m-(m-d),y=d-f,m=Y*o,h=m-(m-o),j=o-h,E=y*j-(k-f*h-y*h-f*j),P=p*n,m=Y*p,f=m-(m-p),y=p-f,m=Y*n,h=m-(m-n),j=n-h,T=y*j-(P-f*h-y*h-f*j),g=E-T,i=E-g,Q[0]=E-(g+i)+(i-T),_=k+g,i=_-k,L=k-(_-i)+(g-i),g=L-P,i=L-g,Q[1]=L-(g+i)+(i-P),C=_+g,i=C-_,Q[2]=_-(C-i)+(g-i),Q[3]=C;const de=Ee(se,Je,4,Q,Ge);return Ge[de-1]}function bt(e,t,r,c,u,l){const a=(t-l)*(r-u),d=(e-u)*(c-l),p=a-d,n=Math.abs(a+d);return Math.abs(p)>=pt*n?p:-xt(e,t,r,c,u,l,n)}function vt(e,t){var r,c,u=0,l,a,d,p,n,o,i,m=e[0],f=e[1],y=t.length;for(r=0;r<y;r++){c=0;var h=t[r],j=h.length-1;if(o=h[0],o[0]!==h[j][0]&&o[1]!==h[j][1])throw new Error("First and last coordinates in a ring must be the same");for(a=o[0]-m,d=o[1]-f,c;c<j;c++){if(i=h[c+1],p=i[0]-m,n=i[1]-f,d===0&&n===0){if(p<=0&&a>=0||a<=0&&p>=0)return 0}else if(n>=0&&d<=0||n<=0&&d>=0){if(l=bt(a,p,d,n,0,0),l===0)return 0;(l>0&&n>0&&d<=0||l<0&&n<=0&&d>0)&&u++}o=i,d=n,a=p}}return u%2!==0}var X=63710088e-1,wt={centimeters:X*100,centimetres:X*100,degrees:360/(2*Math.PI),feet:X*3.28084,inches:X*39.37,kilometers:X/1e3,kilometres:X/1e3,meters:X,metres:X,miles:X/1609.344,millimeters:X*1e3,millimetres:X*1e3,nauticalmiles:X/1852,radians:1,yards:X*1.0936};function yt(e,t,r={}){const c={type:"Feature"};return(r.id===0||r.id)&&(c.id=r.id),r.bbox&&(c.bbox=r.bbox),c.properties={},c.geometry=e,c}function ue(e,t,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ye(e[0])||!Ye(e[1]))throw new Error("coordinates must contain numbers");return yt({type:"Point",coordinates:e},t,r)}function jt(e,t="kilometers"){const r=wt[t];if(!r)throw new Error(t+" units is invalid");return e*r}function ye(e){return e%360*Math.PI/180}function Ye(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ce(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Nt(e){return e.type==="Feature"?e.geometry:e}function St(e,t,r={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const c=Ce(e),u=Nt(t),l=u.type,a=t.bbox;let d=u.coordinates;if(a&&_t(c,a)===!1)return!1;l==="Polygon"&&(d=[d]);let p=!1;for(var n=0;n<d.length;++n){const o=vt(c,d[n]);if(o===0)return!r.ignoreBoundary;o&&(p=!0)}return p}function _t(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}var kt=St;function Ke(e,t,r){const c=b.useRef(!1);b.useEffect(()=>{if(!e||typeof window>"u"||!window.history?.pushState)return;const u=`modal:${r}`,l={...window.history.state||{},[u]:!0};window.history.pushState(l,"",window.location.href),c.current=!0;const a=d=>{d.state?.[u]&&t()};return window.addEventListener("popstate",a),()=>{window.removeEventListener("popstate",a),c.current=!1}},[e,t,r])}const Et=e=>{const t=[];for(const c of e)/[\p{L}\p{N}]/u.test(c)?t.push(c):(c===" "||c==="-"||c==="_")&&t.push("_");return(t.join("").replace(/^_+|_+$/g,"")||"massif").toUpperCase()},He=e=>`https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//bra/BRA_${e.code}_${Et(e.massif)}.pdf`,Qe=({lat:e,lon:t,onResult:r,variant:c="card"})=>{const[u,l]=b.useState(null),[a,d]=b.useState(null),[p,n]=b.useState(!1),[o,i]=b.useState(!1),[m,f]=b.useState(null),[y,h]=b.useState(0),[j,g]=b.useState(1),[_,L]=b.useState(!1),[k,E]=b.useState(!1),[P,T]=b.useState(null),[C,q]=b.useState(0),I=b.useRef(null),D=b.useRef(null);Ke(p,()=>n(!1),"bera"),Ke(_,()=>L(!1),"forecast");const F=typeof document<"u"?document.body:null;b.useEffect(()=>{(async()=>{try{const W=await fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/massifs/massifs.geojson",{cache:"no-cache"});if(!W.ok)throw new Error(`Erreur HTTP ${W.status}`);const V=await W.json();l(V.features)}catch(W){console.error("Failed to load GeoJSON:",W)}})()},[]),b.useEffect(()=>{if(!u)return;const R=ue([t,e]);let W=null;for(const V of u)if(kt(R,V)){W=V.properties;break}d(W),r&&r(W)},[e,t,u,r]),b.useEffect(()=>{if(!p||!a){g(1),h(0);return}const R=He(a);i(!0),f(null),g(1);const W=()=>window.pdfjsLib?Promise.resolve():new Promise(($,re)=>{const oe=document.createElement("script");oe.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",oe.onload=()=>{window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",$(void 0)},oe.onerror=re,document.head.appendChild(oe)});let V=!1;return W().then(()=>{if(!V)return fetch(R).then($=>{if(!$.ok)throw new Error(`Erreur HTTP ${$.status}`);return $.arrayBuffer()})}).then($=>{if(!(V||!window.pdfjsLib))return window.pdfjsLib.getDocument({data:$}).promise}).then($=>{V||(D.current=$,h($.numPages),i(!1),z(1))}).catch($=>{V||(console.error("Erreur de chargement PDF:",$),f("Impossible de charger le PDF"),i(!1))}),()=>{V=!0}},[p,a]);const z=R=>{!D.current||!I.current||D.current.getPage(R).then(W=>{if(!I.current)return;const V=I.current,$=V.getContext("2d");if(!$)return;const re=W.getViewport({scale:1.5});V.height=re.height,V.width=re.width;const oe={canvasContext:$,viewport:re};W.render(oe)})};if(b.useEffect(()=>{j>0&&y>0&&z(j)},[j,y]),!u)return s.jsx("div",{className:"p-4 text-gray-500 w-full",children:"Chargement des massifs…"});if(!a)return s.jsx("div",{className:"p-3 text-amber-600 bg-amber-50 rounded-lg w-full",children:"Aucune donnée"});const K=He(a),se=`${`https://cloudflare-worker.ncsdecoopman.workers.dev/meteogram?lat=${e}&lon=${t}`}&v=${C}`,de="inline-flex items-center gap-2 bg-[var(--input-bg)] border border-[var(--border)] rounded-[var(--radius)] px-2.5 sm:px-4 h-12 text-[13px] sm:text-sm font-medium text-[var(--text-main)] shadow-sm transition-all hover:border-[var(--primary)] hover:ring-1 hover:ring-[var(--primary)] focus:outline-none justify-center flex-1 min-w-0 w-full",le=s.jsxs("button",{onClick:()=>n(!0),className:de,children:[s.jsx("span",{className:"sm:hidden",children:"BERA"}),s.jsx("span",{className:"hidden sm:inline",children:"Voir le BERA"})]}),pe=s.jsxs("button",{onClick:()=>{T(null),E(!0),L(!0),q(R=>R+1)},className:de,children:[s.jsx("span",{className:"sm:hidden",children:"Prévisions"}),s.jsx("span",{className:"hidden sm:inline",children:"Voir les prévisions"})]});return s.jsxs(s.Fragment,{children:[c==="inline"?s.jsxs("div",{className:"w-full grid grid-cols-2 gap-2 sm:flex sm:flex-row sm:items-center sm:gap-2",children:[le,pe]}):s.jsxs("div",{className:"grid grid-cols-2 sm:inline-flex sm:flex-row items-center gap-2 bg-[var(--card-bg)] px-3 py-2 rounded-[var(--radius)] shadow-[var(--shadow)] border border-[var(--border)] mt-4 w-full",children:[le,pe]}),p&&F&&Ve.createPortal(s.jsx("div",{className:"fixed inset-0 z-[6000] flex sm:items-center sm:justify-center p-0 sm:p-4 bg-black/70 backdrop-blur-sm",onClick:()=>n(!1),children:s.jsxs("div",{className:"bg-[var(--card-bg)] w-full h-full sm:h-[85vh] sm:max-w-4xl sm:rounded-[var(--radius)] shadow-2xl flex flex-col overflow-hidden animate-[scaleUp_0.2s_ease-out]",onClick:R=>R.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[var(--border)]",children:[s.jsxs("h3",{className:"font-semibold text-lg text-[var(--text-main)]",children:["BRA - ",a.massif," (",a.departement,")"]}),s.jsx("button",{onClick:()=>n(!1),className:"p-2 text-[var(--text-muted)] hover:text-[var(--text-main)] hover:bg-[var(--input-bg)] rounded-lg transition-colors",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsxs("div",{className:"flex-1 bg-gray-100 relative overflow-auto flex flex-col",children:[o&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white z-10",children:s.jsx("div",{className:"text-gray-600",children:"Chargement du PDF..."})}),m&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white z-10",children:s.jsxs("div",{className:"text-center p-8",children:[s.jsx("p",{className:"text-red-600 mb-4",children:m}),s.jsxs("a",{href:K,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-[var(--primary)] text-white rounded-lg hover:bg-[var(--primary-hover)] transition-colors inline-flex items-center gap-2",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),s.jsx("polyline",{points:"15 3 21 3 21 9"}),s.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]}),"Ouvrir le PDF dans un nouvel onglet"]})]})}),y>0&&!o&&!m&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-300 p-4 flex items-center justify-center gap-4 z-20",children:[s.jsx("button",{onClick:()=>g(R=>Math.max(1,R-1)),disabled:j<=1,className:"px-4 py-2 bg-[var(--primary)] text-white rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[var(--primary-hover)] transition-colors",children:"Précédent"}),s.jsxs("span",{className:"text-gray-700 whitespace-nowrap",children:["Page ",j," sur ",y]}),s.jsx("button",{onClick:()=>g(R=>Math.min(y,R+1)),disabled:j>=y,className:"px-4 py-2 bg-[var(--primary)] text-white rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[var(--primary-hover)] transition-colors",children:"Suivant"})]}),s.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:s.jsx("canvas",{ref:I,className:"shadow-lg max-w-full"})})]})]})]})}),F),_&&F&&Ve.createPortal(s.jsx("div",{className:"fixed inset-0 z-[6000] flex sm:items-center sm:justify-center p-0 sm:p-4 bg-black/70 backdrop-blur-sm",onClick:()=>L(!1),children:s.jsxs("div",{className:"bg-[var(--card-bg)] w-full h-full sm:h-[90vh] sm:max-w-5xl sm:rounded-[var(--radius)] shadow-2xl overflow-hidden animate-[scaleUp_0.2s_ease-out] flex flex-col",onClick:R=>R.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[var(--border)]",children:[s.jsx("h3",{className:"font-semibold text-lg text-[var(--text-main)]",children:"Prévisions 5 jours (météogramme)"}),s.jsx("button",{onClick:()=>L(!1),className:"p-2 text-[var(--text-muted)] hover:text-[var(--text-main)] hover:bg-[var(--input-bg)] rounded-lg transition-colors",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsxs("div",{className:"flex-1 bg-[var(--card-bg)] p-2 overflow-auto relative min-h-[320px]",children:[k&&s.jsxs("div",{className:"absolute inset-0 bg-[var(--card-bg)]/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center gap-3 text-[var(--text-main)]",children:[s.jsx("div",{className:"w-10 h-10 border-4 border-[var(--border)] border-t-[var(--primary)] rounded-full animate-spin","aria-hidden":!0}),s.jsx("span",{className:"text-sm font-medium",children:"Chargement des prévisions..."})]}),P&&!k&&s.jsxs("div",{className:"absolute inset-0 bg-[var(--card-bg)]/90 z-10 flex flex-col items-center justify-center gap-3 text-center p-4",children:[s.jsx("p",{className:"text-red-600 font-medium",children:P}),s.jsx("button",{onClick:()=>{T(null),E(!0),q(R=>R+1)},className:"px-4 py-2 bg-[var(--primary)] text-white rounded-lg hover:bg-[var(--primary-hover)] transition-colors",children:"Réessayer"})]}),s.jsx("img",{src:se,alt:"Météogramme 5 jours",className:"w-full h-full object-contain rounded-[var(--radius)] min-h-[300px]",onLoad:()=>E(!1),onError:()=>{E(!1),T("Impossible de charger les prévisions pour le moment.")}})]})]})}),F),s.jsx("style",{children:`
                @keyframes scaleUp {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
            `})]})};function Mt(e,t,r={}){var c=Ce(e),u=Ce(t),l=ye(u[1]-c[1]),a=ye(u[0]-c[0]),d=ye(c[1]),p=ye(u[1]),n=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(d)*Math.cos(p);return jt(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),r.units)}var Fe=Mt;const Pt=({lat:e,lon:t,altitude:r,radiusKm:c=5,onStationsChange:u})=>{const[l,a]=b.useState(null);b.useEffect(()=>{(async()=>{try{const n=await fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/stations/stations.geojson",{cache:"no-cache"});if(!n.ok)throw new Error(`Erreur HTTP ${n.status}`);const o=await n.json();a(o.features)}catch(n){console.error("Erreur lors du chargement des stations:",n)}})()},[]);const d=b.useMemo(()=>{if(!l)return[];const p=ue([t,e]);return l.map(n=>{const o=ue(n.geometry.coordinates),i=Fe(p,o,{units:"kilometers"}),m=n.properties.altitude||n.properties.alt||n.properties.elevation,f=r!==void 0&&m!==void 0?m-r:void 0,y=n.properties.geo_id_insee||n.properties.id||n.properties.code||n.properties.insee||n.properties.station_id,h=n.properties.name||n.properties.nom||n.properties.libelle||"Station inconnue",j=i<=c;return{lat:n.geometry.coordinates[1],lon:n.geometry.coordinates[0],name:h,distance:i,altitude:m,altitudeDiff:f,stationId:y,inRadius:j}})},[l,e,t,c,r]);return b.useEffect(()=>{u&&u(d)},[d,u]),null},Rt="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.11.0/sql-wasm.js",Xe="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.11.0",Lt="https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//conditions/conditions.sqlite";let je=null;function Ct(){return typeof window>"u"?Promise.resolve(null):window.initSqlJs?window.initSqlJs({locateFile:e=>`${Xe}/${e}`}):je||(je=new Promise((e,t)=>{const r=document.createElement("script");r.src=Rt,r.async=!0,r.onload=()=>{window.initSqlJs?window.initSqlJs({locateFile:c=>`${Xe}/${c}`}).then(e).catch(t):t(new Error("initSqlJs non disponible"))},r.onerror=()=>t(new Error("Impossible de charger sql.js")),document.head.appendChild(r)}),je)}async function At(){const e=await Ct();if(!e)return null;const r=await(await fetch(Lt,{cache:"no-cache"})).arrayBuffer();return new e.Database(new Uint8Array(r))}const Dt=({lat:e,lon:t,radiusKm:r=5,referenceAltitude:c,onConditionsChange:u})=>{const[l,a]=b.useState([]);b.useEffect(()=>{let p=!1;return(async()=>{try{const o=await At();if(!o)return;const i=o.prepare("SELECT * FROM conditions WHERE lat IS NOT NULL AND lon IS NOT NULL"),m=[];for(;i.step();){const f=i.getAsObject();m.push({id:Number(f.id),sortie_id:f.sortie_id!==null?Number(f.sortie_id):void 0,source_url:f.source_url,date_iso:f.date_iso,orientation:f.orientation,dif_ski:f.dif_ski,skiabilite:f.skiabilite,nom:f.nom,altitude:f.altitude!==null&&f.altitude!==void 0?Number(f.altitude):null,lat:f.lat!==null?Number(f.lat):null,lon:f.lon!==null?Number(f.lon):null,meteo_temperatures:f.meteo_temperatures,acces_parking:f.acces_parking,alt_chaussage_dechaussage:f.alt_chaussage_dechaussage,conditions_ski:f.conditions_ski,conditions_nivo_avalancheuse:f.conditions_nivo_avalancheuse,conditions_autres:f.conditions_autres})}i.free(),o.close(),p||a(m)}catch(o){console.error("Erreur lors du chargement des conditions",o),p||a([])}})(),()=>{p=!0}},[]);const d=b.useMemo(()=>{if(!l.length)return[];const p=ue([t,e]);return l.map(n=>{if(n.lat===void 0||n.lat===null||n.lon===void 0||n.lon===null)return n;const o=ue([n.lon,n.lat]),i=Fe(p,o,{units:"kilometers"}),m=n.altitude!==null&&n.altitude!==void 0&&c!==void 0?n.altitude-c:null;return{...n,distance:i,inRadius:i<=r,altitudeDiff:m}})},[l,e,t,r,c]);return b.useEffect(()=>{u&&u(d)},[d,u]),null},Tt="https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/webcams/webcams.geojson",fe=e=>e.toString().padStart(2,"0"),Ft=e=>e.toString().padStart(3,"0"),It=e=>{const t=new Date(e.getFullYear(),0,1),r=e.getTime()-t.getTime();return Math.floor(r/(1e3*60*60*24))+1},$t=(e,t,r,c,u)=>{const l=u||"Europe/Paris",a=e.toLocaleString("en-US",{timeZone:l}),d=new Date(a),p=new Date(d.getTime()+r*6e4),n=new Date(p);n.setHours(0,0,0,0);const o=(p.getTime()-n.getTime())/6e4,f=Math.floor(o/t)*t+c;return new Date(n.getTime()+f*6e4)},Bt=(e,t,r)=>{const c=t.getFullYear(),u=t.getMonth()+1,l=t.getDate(),a=t.getHours(),d=t.getMinutes(),p=t.getSeconds(),n=It(t),o=a%12===0?12:a%12,i=a<12?"AM":"PM",m=Math.floor(t.getTime()/1e3),f=t.toLocaleDateString(r,{weekday:"short"}),y=t.toLocaleDateString(r,{weekday:"long"}),h=t.toLocaleDateString(r,{month:"short"}),j=t.toLocaleDateString(r,{month:"long"});return e.replace(/{yyyy}/g,c.toString()).replace(/{yy}/g,c.toString().slice(-2)).replace(/{mmmm}/g,j).replace(/{mmm}/g,h).replace(/{mm}/g,fe(u)).replace(/{m}/g,u.toString()).replace(/{dd}/g,fe(l)).replace(/{d}/g,l.toString()).replace(/{eeee}/g,y).replace(/{eee}/g,f).replace(/{u}/g,t.getDay().toString()).replace(/{ddd}/g,Ft(n)).replace(/{hh}/g,fe(a)).replace(/{h}/g,a.toString()).replace(/{kk}/g,fe(o)).replace(/{k}/g,o.toString()).replace(/{A}/g,i).replace(/{ii}/g,fe(d)).replace(/{i}/g,d.toString()).replace(/{ss}/g,fe(p)).replace(/{X}/g,m.toString())},Ot=e=>{const t=e.url_image;if(!t||typeof t!="string")return{url:void 0,imageDate:null};const r=t.trim();if(!r.includes("{"))return{url:r,imageDate:null};const c=e.periodicite??null;if(!c||c<=0)return{url:r,imageDate:null};const u=e.decalage_horloge??0,l=e.decalage_periodicite??0,a=e.fuseau_horaire??void 0,d=e.code_locale??"fr-FR",n=$t(new Date,c,u,l,a);return{url:Bt(r,n,d),imageDate:n.toISOString()}},qt=({lat:e,lon:t,radiusKm:r=5,referenceAltitude:c,onWebcamsChange:u})=>{const[l,a]=b.useState([]);b.useEffect(()=>{let p=!1;return(async()=>{try{const o=await fetch(Tt,{cache:"no-cache"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const i=await o.json();p||a(i.features||[])}catch(o){console.error("Erreur lors du chargement des webcams:",o),p||a([])}})(),()=>{p=!0}},[]);const d=b.useMemo(()=>{if(!l.length)return[];const p=ue([t,e]);return l.map(n=>{const o=n.properties||{},i=o.statut_enligne??o.statut_en_ligne,m=typeof i=="string"?i.trim().toUpperCase():void 0,f=n.geometry?.coordinates,y=f?.[0]??o.lon,h=f?.[1]??o.lat;if(h===void 0||y===void 0)return null;const j=ue([Number(y),Number(h)]),g=Fe(p,j,{units:"kilometers"}),_=o.id,L=_!==void 0?String(_):`${y}-${h}`,k=o.name||`Webcam ${L}`,E=o.altitude??o.alt??o.elevation??o.ele??o.alt_m??o.altitude_m,P=E!=null&&E!==""?Number(E):void 0,T=P!==void 0&&c!==void 0?P-c:null,{url:C,imageDate:q}=Ot(o),I=C??(typeof o.url_image=="string"&&o.url_image.trim()!==""?o.url_image.trim():void 0),D=o.url_page,F=typeof D=="string"&&D.trim()!==""?D.trim():void 0,z=o.statut_variable,K=typeof z=="string"&&z.trim()!==""?z.trim():void 0,ce=o.largeur!==void 0&&o.largeur!==null?Number(o.largeur):null,se=o.hauteur!==void 0&&o.hauteur!==null?Number(o.hauteur):null;return{id:L,name:k,lat:Number(h),lon:Number(y),distance:g,inRadius:g<=r,altitude:P,altitudeDiff:T,imageUrl:I,imageDate:q,imagePattern:o.url_image||void 0,pageUrl:F,status:m,statusVariable:K,periodicite:o.periodicite??null,decalage_periodicite:o.decalage_periodicite??null,decalage_horloge:o.decalage_horloge??null,fuseau_horaire:o.fuseau_horaire??null,code_locale:o.code_locale??null,largeur:ce,hauteur:se}}).filter(Boolean)},[l,e,t,r,c]);return b.useEffect(()=>{u&&u(d)},[d,u]),null},tt="naivo:lastMapView",Me=e=>typeof e=="number"&&Number.isFinite(e),Pe=(e,t,r)=>Math.min(r,Math.max(t,e));function zt(e=tt){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(e);if(!t)return null;const r=JSON.parse(t);if(!r||typeof r!="object")return null;const c=r,u=c.center,l=c.zoom;if(!Array.isArray(u)||u.length!==2)return null;const a=u[0],d=u[1];return!Me(a)||!Me(d)||!Me(l)?null:{center:[Pe(a,-90,90),Pe(d,-180,180)],zoom:Pe(l,0,22)}}catch{return null}}function ss(e,t=tt){if(!(typeof window>"u"))try{const r={center:[Number(e.center[0].toFixed(6)),Number(e.center[1].toFixed(6))],zoom:Number(e.zoom.toFixed(2))};window.localStorage.setItem(t,JSON.stringify(r))}catch{}}const Ut=ae.lazy(()=>ct(()=>import("./MiniMap.hs6gm6as.js"),__vite__mapDeps([0,1,2]))),be=[{code:"04",name:"alpes de haute provence"},{code:"05",name:"hautes alpes"},{code:"06",name:"alpes maritimes"},{code:"38",name:"isere"},{code:"73",name:"savoie"},{code:"74",name:"haute savoie"}],Ne={lonLeft:4,latTop:46.8,lonRight:8.1,latBottom:42.9},Vt={center:[45.69139,6.69056],zoom:10},Z=e=>e?e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim():"",Se=e=>e.trim().replace(/\s+/g," "),Re=e=>{const t=Se(e);if(!t)return null;let r=t;return r=r.replace(/^l[’']/i,""),r=r.replace(/^(?:la|le|les)\s+/i,""),r=r.trim(),!r||r===t?null:r},Wt=(e,t)=>{const c=(t==="openmeteo"?Array.isArray(e.postcodes)?e.postcodes:[]:[e?.address?.postcode,e?.postcode].filter(Boolean)).some(d=>be.some(p=>String(d).startsWith(p.code))),l=(t==="openmeteo"?[e?.display_name,e?.admin2,e?.admin1].map(Z):[e?.display_name,e?.address?.department,e?.address?.state_district,e?.address?.county,e?.address?.state,e?.address?.region].map(Z)).some(d=>d&&be.some(p=>d.includes(p.name)));return(t==="openmeteo"?Z(e?.country_code)==="fr":Z(e?.address?.country_code)==="fr"||Z(e?.address?.country)==="france"||Z(e?.display_name).includes("france"))&&(c||l)},Le=(e,t)=>(e||[]).filter(r=>Wt(r,t)),Jt=new Set(["municipality","locality"]),Ze=new Set(["city","town","village","hamlet","locality","isolated_dwelling","municipality"]),Gt=new Set(["peak","ridge","saddle","valley","glacier","cliff","rock","mountain","mountain_range","mountain_pass"]),Yt=new Set(["parking","parking_entrance"]),Kt=e=>{if(!e||typeof e!="object")return!1;const t=e.category??e.class,r=e.type,c=e.addresstype;return t==="place"?Ze.has(r):t==="natural"?Gt.has(r):t==="amenity"?Yt.has(r):t==="boundary"&&r==="administrative"?Ze.has(c):!1},Ht=e=>{const t=e.label||e.name||e.address?.village||e.address?.town||e.address?.city||(typeof e.display_name=="string"?e.display_name.split(",")[0]:""),r=e.admin2||e.address?.county;return[t,r].filter(Boolean).join(" · ").trim()||"Lieu"},ve=e=>{const t=[e?.address?.postcode,e?.postcode,...Array.isArray(e?.postcodes)?e.postcodes:[]].filter(Boolean).map(c=>String(c).trim()).filter(Boolean);return t.find(c=>be.some(u=>c.startsWith(u.code)))||t[0]},Ae=e=>{const t=ve(e);if(t&&t.length>=2){const u=t.slice(0,2);if(be.some(l=>l.code===u))return u}const r=Z(e?.address?.department||e?.address?.state_district||e?.address?.county||e?.admin2||e?.display_name);return be.find(u=>r.includes(u.name))?.code},Qt=e=>e?.address?.city||e?.address?.town||e?.address?.village||e?.address?.municipality||e?.address?.hamlet||e?.address?.locality||void 0,De=e=>e.label||e.name||e.namedetails?.name||e.address?.village||e.address?.town||e.address?.city||(typeof e.display_name=="string"?e.display_name.split(",")[0]:""),Te=e=>{const t=De(e),r=ve(e),c=Ae(e),u=Qt(e),l=[];r&&l.push(r),u&&Z(u)!==Z(t)&&l.push(u);const a=[t].filter(Boolean);return l.length&&a.push(`— ${l.join(" ")}`),c&&a.push(`(${c})`),a.join(" ").trim()||Ht(e)},Xt=e=>{const t=Z(Te(e));if(t)return`label:${t}`;const r=Z(e?.display_name),c=Number(e?.lat),u=Number(e?.lon),l=`${Number.isFinite(c)?c.toFixed(4):""},${Number.isFinite(u)?u.toFixed(4):""}`;return`fallback:${r}:${l}`},Zt=(e,t,r,c)=>{const u=o=>o*Math.PI/180,a=u(r-e),d=u(c-t),p=Math.sin(a/2)*Math.sin(a/2)+Math.cos(u(e))*Math.cos(u(r))*Math.sin(d/2)*Math.sin(d/2);return 6371*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))},et=e=>{let t=0;ve(e)&&(t+=10);const r=e?.provider;return r==="ban"?t+=3:r==="nominatim"?t+=2:r==="openmeteo"&&(t+=1),e?.display_name&&(t+=1),(e?.address?.city||e?.address?.town||e?.address?.village)&&(t+=1),t},es=(e,t)=>{const r=Z(De(e)),c=Z(De(t));if(!r||!c||r!==c)return!1;const u=Ae(e),l=Ae(t);if(u&&l&&u!==l)return!1;const a=ve(e),d=ve(t);if(u&&l&&(a&&!d||!a&&d)||a&&d&&a===d)return!0;const p=Number(e?.lat),n=Number(e?.lon),o=Number(t?.lat),i=Number(t?.lon);return!Number.isFinite(p)||!Number.isFinite(n)||!Number.isFinite(o)||!Number.isFinite(i)?!1:Zt(p,n,o,i)<=2};function rs(){const[e,t]=b.useState(""),[r,c]=b.useState([]),[u,l]=b.useState(!1),[a,d]=b.useState(null),[p,n]=b.useState(!1),[o,i]=b.useState(null),[m,f]=b.useState(!1),[y,h]=b.useState(null),[j,g]=b.useState(null),[_,L]=b.useState(!1),[k,E]=b.useState([]),[P,T]=b.useState([]),[C,q]=b.useState([]),[I,D]=b.useState(8),[F,z]=b.useState(!1),[K,ce]=b.useState(!0),[se,de]=b.useState(!0),[le,pe]=b.useState(!0),R=ae.useRef(null),W=ae.useRef(null),V=ae.useRef(!1),$=ae.useRef(null),re=ae.useRef(!1);b.useEffect(()=>{if(typeof window>"u")return;const v=window.matchMedia("(max-width: 768px)"),x=()=>{const N=v.matches;n(N),N&&!a?i(zt()??Vt):N||i(null)};return x(),typeof v.addEventListener=="function"?(v.addEventListener("change",x),()=>v.removeEventListener("change",x)):(v.addListener(x),()=>v.removeListener(x))},[a]);const oe=ae.useCallback(v=>{const x=document.getElementById(v);x&&x.dispatchEvent(new MouseEvent("click",{bubbles:!0}))},[]),st=ae.useCallback(()=>{t(""),c([]),l(!1),g(null),d(null),E([]),T([]),q([]),R.current?.focus(),z(!1)},[]),rt=ae.useMemo(()=>{const v=new Map;return P.forEach(x=>{if(x.lat===void 0||x.lat===null||x.lon===void 0||x.lon===null)return;const N=`${x.lat.toFixed(5)}-${x.lon.toFixed(5)}`,B=v.get(N)||{lat:x.lat,lon:x.lon,distance:x.distance,inRadius:x.inRadius,entries:[]};B.entries.push(x),x.distance!==void 0&&(B.distance=x.distance),x.inRadius!==void 0&&(B.inRadius=x.inRadius),v.set(N,B)}),Array.from(v.values())},[P]),nt=async(v,x)=>{try{const N=await fetch("https://api.open-elevation.com/api/v1/lookup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:[{latitude:v,longitude:x}]})});if(N.ok){const B=await N.json();if(B.results&&B.results.length>0&&B.results[0].elevation)return Math.round(B.results[0].elevation)}}catch(N){console.error("Erreur lors de la récupération de l'altitude :",N)}};b.useEffect(()=>{const v=setTimeout(async()=>{if(e.length<3){c([]),l(!1),h(null);return}if(V.current){V.current=!1;return}f(!0);try{const x=async()=>{const A=async ee=>{const M=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(Se(ee))}&count=10&language=fr&format=json`);if(!M.ok)return[];const te=await M.json();return te.results?te.results.map(S=>({provider:"openmeteo",label:S.name||S.admin2||S.admin1,display_name:`${S.name}${S.admin2?`, ${S.admin2}`:""}${S.admin1?`, ${S.admin1}`:""}${S.country?`, ${S.country}`:""}`,lat:S.latitude,lon:S.longitude,extratags:S.elevation?{ele:S.elevation}:void 0,admin1:S.admin1,admin2:S.admin2,country_code:S.country_code,postcodes:S.postcodes})):[]},O=await A(e);if(O.length>0)return O;const J=Re(e);return J?A(J):O},N=async()=>{const A=async ee=>{const M=new URL("https://nominatim.openstreetmap.org/search");M.searchParams.set("format","jsonv2"),M.searchParams.set("q",Se(ee)),M.searchParams.set("limit","50"),M.searchParams.set("countrycodes","fr"),M.searchParams.set("addressdetails","1"),M.searchParams.set("extratags","1"),M.searchParams.set("namedetails","1"),M.searchParams.set("accept-language","fr"),M.searchParams.set("viewbox",`${Ne.lonLeft},${Ne.latTop},${Ne.lonRight},${Ne.latBottom}`),M.searchParams.set("bounded","1");const te=await fetch(M.toString(),{headers:{"Accept-Language":"fr"}});if(!te.ok)return[];const S=await te.json();return Array.isArray(S)?S.filter(Kt).map(w=>({...w,provider:"nominatim",label:w.name||w.address?.village||w.address?.town||w.address?.city||(typeof w.display_name=="string"?w.display_name.split(",")[0]:void 0)})):[]},O=await A(e);if(O.length>0)return O;const J=Re(e);return J?A(J):O},B=async()=>{const A=async ee=>{const M=async w=>{const ge=new URL("https://api-adresse.data.gouv.fr/search/");ge.searchParams.set("q",Se(ee)),ge.searchParams.set("limit","15"),ge.searchParams.set("autocomplete","1"),w&&ge.searchParams.set("type",w);const Be=await fetch(ge.toString());if(!Be.ok)return[];const Oe=await Be.json();return Oe?.features?Oe.features.filter(U=>Jt.has(U?.properties?.type)).map(U=>({provider:"ban",label:U.properties?.name||U.properties?.city||U.properties?.label,display_name:U.properties?.label||U.properties?.name||U.properties?.city||"Lieu",lat:U.geometry?.coordinates?.[1],lon:U.geometry?.coordinates?.[0],address:{postcode:U.properties?.postcode,city:U.properties?.city,county:U.properties?.city,state:U.properties?.context,country:"France",country_code:"fr"},postcodes:U.properties?.postcode?[U.properties.postcode]:void 0})).filter(U=>U.lat!==void 0&&U.lon!==void 0):[]},te=await M("municipality");if(te.length>0)return te;const S=await M("locality");return S.length>0?S:M()},O=await A(e);if(O.length>0)return O;const J=Re(e);return J?A(J):O};let G=[];try{G=await x()}catch(A){console.error("Geocoding Open-Meteo en erreur:",A)}const H=(A,O)=>{if(!O||O.length===0)return A;const J=[...A];for(const ee of O){const M=J.findIndex(S=>es(S,ee));if(M===-1){J.push(ee);continue}const te=J[M];et(ee)>et(te)&&(J[M]=ee)}return J};let ne=H([],Le(G,"openmeteo"));if(ne.length<5)try{const A=Le(await N(),"nominatim");ne=H(ne,A)}catch(A){console.error("Geocoding Nominatim en erreur:",A)}if(ne.length<3)try{const A=Le(await B(),"ban");ne=H(ne||[],A)}catch(A){console.error("Geocoding Adresse Data Gouv en erreur:",A)}const he=(ne||[]).slice(0,10);c(he),l(he.length>0),h(ne.length===0?"Aucune suggestion dans les départements 04, 05, 06, 38, 73 ou 74.":null)}catch(x){console.error(x)}finally{f(!1)}},300);return()=>clearTimeout(v)},[e]);const Ie=async v=>{V.current=!0,t(Te(v)),R.current?.blur(),c([]),l(!1),g(null),h(null);const x=parseFloat(v.lat),N=parseFloat(v.lon);if(!Number.isFinite(x)||!Number.isFinite(N)){h("Localisation invalide.");return}let B=v.extratags?.ele?parseFloat(v.extratags.ele):void 0;if(Number.isNaN(B)&&(B=void 0),d({lat:x,lon:N,altitude:B}),setTimeout(()=>{W.current?.scrollIntoView({behavior:"smooth",block:"start"})},0),B===void 0){L(!0);try{const G=await nt(x,N);G!==void 0&&d(H=>!H||H.lat!==x||H.lon!==N?H:{...H,altitude:G})}finally{L(!1)}}},at=()=>{setTimeout(()=>l(!1),200)};b.useEffect(()=>{if(typeof document>"u")return;const v=document.body;if(!v)return;const x=!!a||!!p;v.classList.toggle("has-query",x)},[a,p]);const $e=!!(p&&!a&&o),_e=!!a||$e;return s.jsxs("div",{className:"w-full max-w-[calc(100vw-8px)] sm:max-w-4xl mx-auto px-1 sm:px-6 flex flex-col h-full min-h-0 relative",children:[s.jsxs("div",{className:`${_e?"":"pt-8 sm:pt-12 pb-4 sm:pb-6 flex-1"} flex flex-col gap-4 sm:gap-6 ${_e?"mb-2 sm:mb-3":""}`,children:[s.jsxs("div",{className:"relative w-full z-[2000]",children:[s.jsxs("div",{className:"w-full flex flex-col md:flex-row md:items-center gap-3 sm:gap-4 p-3 sm:p-5 rounded-[var(--radius)] bg-[radial-gradient(circle_at_20%_0%,rgba(56,189,248,0.12),transparent_52%),radial-gradient(circle_at_80%_120%,rgba(59,130,246,0.16),transparent_60%),var(--card-bg)] border border-[var(--border)]/80 shadow-[0_16px_40px_rgba(0,0,0,0.55)] ring-1 ring-[rgba(59,130,246,0.22)] backdrop-blur-sm",children:[s.jsxs("div",{className:`${a?"md:w-1/2 w-full":"w-full"}`,children:[s.jsxs("div",{className:"relative flex items-center",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"absolute left-4 text-[var(--primary)] drop-shadow-[0_4px_12px_rgba(59,130,246,0.35)]",children:[s.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),s.jsx("input",{type:"text",id:"massif-search-input",ref:R,value:e,onChange:v=>t(v.target.value),onFocus:()=>e.length>=3&&l(!0),onBlur:at,placeholder:"Entrez un lieu",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,className:"w-full bg-[var(--input-bg)]/90 border border-[var(--border)]/80 rounded-[var(--radius)] h-8 sm:h-12 pl-10 sm:pl-12 pr-12 sm:pr-24 py-0 text-[11px] sm:text-base text-[var(--text-main)] placeholder-[var(--text-main)] placeholder:opacity-90 shadow-[0_12px_30px_rgba(0,0,0,0.45)] ring-offset-1 ring-offset-[rgba(5,7,18,0.75)] focus:outline-none focus:border-[var(--primary)] focus:ring-2 focus:ring-[var(--primary)] focus:shadow-[0_16px_40px_rgba(59,130,246,0.20)] transition-all duration-200"}),e&&s.jsx("button",{type:"button","aria-label":"Effacer la recherche",onClick:st,className:"absolute right-4 sm:right-5 text-[var(--text-muted)] hover:text-[var(--text-main)] focus:outline-none p-2",children:"×"}),m&&s.jsx("div",{className:"absolute right-12 sm:right-14 w-5 h-5 border-2 border-[var(--text-muted)] border-b-transparent rounded-full animate-spin"})]}),u&&r.length>0&&s.jsx("ul",{className:"absolute left-0 right-0 top-[calc(100%-1px)] bg-[var(--card-bg)] border border-[var(--border)] rounded-[var(--radius)] shadow-[var(--shadow)] z-[1800] max-h-[300px] overflow-y-auto list-none m-0 p-0",onTouchStart:v=>{if(v.touches.length!==1)return;re.current=!1;const x=v.touches[0];$.current={x:x.clientX,y:x.clientY}},onTouchMove:v=>{if(v.touches.length!==1)return;const x=$.current;if(!x)return;const N=v.touches[0],B=Math.abs(N.clientX-x.x),G=Math.abs(N.clientY-x.y);(B>6||G>6)&&(re.current=!0)},onTouchEnd:()=>{window.setTimeout(()=>{re.current=!1,$.current=null},0)},onTouchCancel:()=>{re.current=!1,$.current=null},children:r.map((v,x)=>s.jsx("li",{onMouseDown:N=>N.preventDefault(),onClick:N=>{N.preventDefault(),!re.current&&Ie(v)},onKeyDown:N=>{(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),Ie(v))},className:"px-4 py-3 cursor-pointer border-b border-[var(--border)] last:border-0 hover:bg-[var(--input-bg)] transition-colors text-sm text-[var(--text-main)]",role:"button",tabIndex:0,children:Te(v)},Xt(v)||x))})]}),a&&s.jsx("div",{className:"hidden sm:flex w-full md:w-1/2 justify-start md:justify-end items-stretch",children:s.jsx(Qe,{lat:a.lat,lon:a.lon,onResult:v=>{g(v?`${v.massif} (${v.departement}, ${v.insee})`:null)},variant:"inline"})})]}),y&&s.jsx("div",{className:"pointer-events-none absolute left-0 right-0 top-[calc(100%+8px)] z-[1800] flex justify-center",children:s.jsx("div",{className:"pointer-events-auto px-3 py-2 sm:px-4 sm:py-3 text-red-200 bg-red-900/90 border border-red-700 rounded-lg shadow-lg max-w-full",children:y})})]}),!a&&!$e&&s.jsxs("div",{className:"flex flex-col flex-1 w-full items-center justify-evenly text-center gap-6 sm:gap-8",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-white",children:"Quelle zone explorer aujourd'hui ?"}),s.jsx("p",{className:"text-sm text-white/75",children:"Cherche ton point de départ."})]}),s.jsx("div",{className:"w-full flex items-center justify-center",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("a",{href:"/tutoriel",className:"inline-flex p-0 bg-transparent border-0 shadow-none hover:opacity-90 transition-opacity","aria-label":"Voir le tutoriel Naivo",children:s.jsx("img",{src:"/icons/tuto.svg",alt:"Voir le tutoriel Naivo",className:"h-10 w-auto"})}),s.jsx("button",{type:"button",onClick:()=>oe("install-pwa-android"),className:"p-0 bg-transparent border-0 shadow-none hover:opacity-90 transition-opacity","aria-label":"Installer Naivo sur Google Play",children:s.jsx("img",{src:"/app/googleplay.svg",alt:"Installer Naivo sur Google Play",className:"h-10 w-auto"})}),s.jsx("button",{type:"button",onClick:()=>oe("install-pwa-ios"),className:"p-0 bg-transparent border-0 shadow-none hover:opacity-90 transition-opacity","aria-label":"Installer Naivo sur l'App Store",children:s.jsx("img",{src:"/app/appstore.svg",alt:"Installer Naivo sur l'App Store",className:"h-10 w-auto"})})]})})]})]}),_e&&(()=>{const v=a?.lat??o?.center[0],x=a?.lon??o?.center[1],N=a?.altitude,B=a?void 0:o??void 0,G=a?I:0;if(v===void 0||x===void 0)return null;const H=k.filter(w=>w.inRadius).length,ne=k.length,he=P.filter(w=>w.inRadius).length,A=P.length,O=C.filter(w=>w.inRadius).length,J=C.length,ee="bg-[var(--input-bg)] border border-[var(--border)] rounded-[var(--radius)] shadow-sm h-auto md:h-12 p-3 sm:p-5",M=w=>`w-full min-w-[78px] sm:min-w-[120px] inline-flex items-center justify-center gap-2 px-2 sm:px-4 h-11 sm:h-12 text-[10px] sm:text-[11px] font-medium rounded-[var(--radius)] shadow-sm text-center transition-colors cursor-pointer border ${w?"bg-[var(--primary)] text-white border-[var(--primary)]":"bg-[var(--input-bg)] border-[var(--border)] opacity-70"}`,te={station:"/markers/stations.svg",condition:"/markers/avis.svg",webcam:"/markers/cams.svg"},S=w=>s.jsx("span",{"aria-hidden":"true",className:"flex-none shrink-0 aspect-square flex items-center justify-center rounded-full border border-[var(--border)] bg-white/90 w-7 h-7 sm:w-8 sm:h-8 shadow-sm",children:s.jsx("img",{src:te[w],alt:"",className:"w-3.5 h-3.5 shrink-0 object-contain"})});return s.jsxs("div",{className:"space-y-3 sm:space-y-4 animate-[slideUp_0.3s_ease-out] w-full flex-1 min-h-0 flex flex-col",children:[s.jsxs("div",{className:"hidden sm:grid grid-cols-1 md:grid-cols-2 gap-3 w-full",children:[s.jsxs("div",{className:`${ee} flex flex-row items-center gap-3 sm:gap-4`,children:[s.jsxs("span",{className:"px-3 rounded-[var(--radius)] text-[var(--text-main)] font-medium text-[12px] min-w-[110px] sm:min-w-[140px] w-auto text-left sm:text-center h-full flex items-center",children:["Rayon : ",G," km"]}),s.jsx("input",{type:"range",min:a?"1":"0",max:"50",step:"1",value:G,disabled:!a,onChange:w=>{D(Number(w.target.value)),R.current?.blur()},onPointerDown:()=>R.current?.blur(),onTouchStart:()=>R.current?.blur(),className:"h-2 w-full bg-[var(--card-bg)] border-[var(--border)] rounded-lg appearance-none cursor-pointer accent-[var(--text-main)]"})]}),s.jsx("div",{className:"w-full",children:s.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 text-[10px] sm:text-[11px]",children:[s.jsxs("button",{type:"button","aria-pressed":K,onClick:()=>ce(w=>!w),className:M(K),children:[S("station"),s.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[s.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[H,"/",ne]}),s.jsxs("span",{children:["station",H>1?"s":""]})]})]}),s.jsxs("button",{type:"button","aria-pressed":se,onClick:()=>de(w=>!w),className:M(se),children:[S("condition"),s.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[s.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[he,"/",A]}),s.jsx("span",{children:"avis"})]})]}),s.jsxs("button",{type:"button","aria-pressed":le,onClick:()=>pe(w=>!w),className:M(le),children:[S("webcam"),s.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[s.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[O,"/",J]}),s.jsxs("span",{children:["cam",O>1?"s":""]})]})]})]})})]}),s.jsx("div",{className:"flex-1 min-h-0 flex",children:s.jsxs("div",{ref:W,className:"relative w-full h-full rounded-[var(--radius)] overflow-hidden border border-[var(--border)]",children:[s.jsx(ae.Suspense,{fallback:s.jsx("div",{className:"w-full h-full bg-gray-100 animate-pulse"}),children:s.jsx(Ut,{lat:v,lon:x,stations:K?k:[],conditions:se?rt:[],webcams:le?C:[],radiusKm:G,initialView:B,showReference:!!a})}),s.jsx("button",{type:"button","aria-label":F?"Masquer les statistiques":"Afficher les statistiques",onClick:()=>z(w=>!w),className:"sm:hidden absolute left-3 bottom-3 z-[5] h-11 w-11 rounded-[10px] bg-[rgba(31,41,55,0.95)] border border-[var(--border)] text-white shadow-[0_10px_30px_rgba(0,0,0,0.4)] backdrop-blur-sm flex items-center justify-center active:scale-[0.97] transition-transform hover:bg-[rgba(255,255,255,0.08)]",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("line",{x1:"4",y1:"7",x2:"20",y2:"7"}),s.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),s.jsx("line",{x1:"4",y1:"17",x2:"20",y2:"17"})]})}),F&&s.jsxs("div",{className:"sm:hidden absolute left-3 right-3 bottom-16 z-[4] bg-[var(--card-bg)]/95 border border-[var(--border)] rounded-[var(--radius)] shadow-[var(--shadow)] backdrop-blur-md p-3 space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px] sm:text-[11px]",children:[s.jsxs("button",{type:"button","aria-pressed":K,onClick:()=>ce(w=>!w),className:M(K),children:[S("station"),s.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[s.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[H,"/",ne]}),s.jsxs("span",{children:["station",H>1?"s":""]})]})]}),s.jsxs("button",{type:"button","aria-pressed":se,onClick:()=>de(w=>!w),className:M(se),children:[S("condition"),s.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[s.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[he,"/",A]}),s.jsx("span",{children:"avis"})]})]}),s.jsxs("button",{type:"button","aria-pressed":le,onClick:()=>pe(w=>!w),className:M(le),children:[S("webcam"),s.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[s.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[O,"/",J]}),s.jsxs("span",{children:["cam",O>1?"s":""]})]})]})]}),s.jsxs("div",{className:"bg-[var(--input-bg)]/90 border border-[var(--border)] rounded-[var(--radius)] shadow-sm p-3 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-[12px] font-medium text-[var(--text-main)]",children:[s.jsx("span",{children:"Rayon"}),s.jsxs("span",{className:"px-2 py-1 rounded-[var(--radius)] bg-[var(--card-bg)] border border-[var(--border)] text-[11px]",children:[G," km"]})]}),s.jsx("input",{type:"range",min:"0",max:"50",step:"5",value:G,disabled:!a,onChange:w=>{D(Number(w.target.value)),R.current?.blur()},onPointerDown:()=>R.current?.blur(),onTouchStart:()=>R.current?.blur(),"aria-label":"Rayon en kilometres",className:"h-2 w-full bg-[var(--card-bg)] border-[var(--border)] rounded-lg appearance-none cursor-pointer accent-[var(--text-main)]"})]}),s.jsx("div",{className:"pt-1",children:s.jsx(Qe,{lat:v,lon:x,onResult:w=>{g(w?`${w.massif} (${w.departement}, ${w.insee})`:null)},variant:"inline"})})]})]})}),s.jsxs("div",{className:"space-y-4",children:[_?s.jsx("div",{className:"bg-[var(--card-bg)] p-4 rounded-[var(--radius)] shadow-[var(--shadow)] border border-[var(--border)]",children:s.jsx("div",{className:"text-sm text-[var(--text-muted)]",children:"Récupération de l'altitude..."})}):s.jsx(Pt,{lat:v,lon:x,radiusKm:G,altitude:N,onStationsChange:w=>{E(w)}}),s.jsx(Dt,{lat:v,lon:x,radiusKm:G,referenceAltitude:N,onConditionsChange:w=>T(w)}),s.jsx(qt,{lat:v,lon:x,radiusKm:G,referenceAltitude:N,onWebcamsChange:w=>q(w)})]})]})})()]})}export{rs as M,ct as _,Bt as a,$t as c,s as j,Ke as u,ss as w};
