const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MiniMap.C0a7F4iE.js","assets/index.CLiwIxch.js","assets/analytics.CwtcqfEL.js","assets/index.BQlc4wYO.css"])))=>i.map(i=>d[i]);
import{r as d,a as xt,R as Se}from"./index.CLiwIxch.js";import{g as gt,d as bt}from"./analytics.CwtcqfEL.js";var Ee={exports:{}},pe={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie;function vt(){if(Ie)return pe;Ie=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function s(l,a,c){var p=null;if(c!==void 0&&(p=""+c),a.key!==void 0&&(p=""+a.key),"key"in a){c={};for(var m in a)m!=="key"&&(c[m]=a[m])}else c=a;return a=c.ref,{$$typeof:e,type:l,key:p,ref:a!==void 0?a:null,props:c}}return pe.Fragment=r,pe.jsx=s,pe.jsxs=s,pe}var Fe;function wt(){return Fe||(Fe=1,Ee.exports=vt()),Ee.exports}var t=wt();function ze(e,r,s,l,a=!1){const c=d.useRef(r),p=d.useRef(e),m=d.useRef(!1);d.useEffect(()=>{c.current=r,p.current=e},[r,e]),d.useEffect(()=>{if(e&&typeof window<"u"&&window.history?.pushState){const i=`modal:${s}`;if(a)window.history.replaceState({...window.history.state||{},[i]:!0},"",window.location.href),m.current=!1;else{const n={...window.history.state||{},[i]:!0};window.history.pushState(n,"",l||window.location.href),m.current=!0}}const x=i=>{const n=`modal:${s}`;!i.state?.[n]&&p.current&&(m.current=!1,c.current())};return window.addEventListener("popstate",x),()=>{window.removeEventListener("popstate",x),m.current&&(m.current=!1,window.history.back())}},[e,s,l,a])}const ne=11102230246251565e-32,G=134217729,yt=(3+8*ne)*ne;function Ce(e,r,s,l,a){let c,p,m,x,i=r[0],n=l[0],o=0,f=0;n>i==n>-i?(c=i,i=r[++o]):(c=n,n=l[++f]);let v=0;if(o<e&&f<s)for(n>i==n>-i?(p=i+c,m=c-(p-i),i=r[++o]):(p=n+c,m=c-(p-n),n=l[++f]),c=p,m!==0&&(a[v++]=m);o<e&&f<s;)n>i==n>-i?(p=c+i,x=p-c,m=c-(p-x)+(i-x),i=r[++o]):(p=c+n,x=p-c,m=c-(p-x)+(n-x),n=l[++f]),c=p,m!==0&&(a[v++]=m);for(;o<e;)p=c+i,x=p-c,m=c-(p-x)+(i-x),i=r[++o],c=p,m!==0&&(a[v++]=m);for(;f<s;)p=c+n,x=p-c,m=c-(p-x)+(n-x),n=l[++f],c=p,m!==0&&(a[v++]=m);return(c!==0||v===0)&&(a[v++]=c),v}function jt(e,r){let s=r[0];for(let l=1;l<e;l++)s+=r[l];return s}function xe(e){return new Float64Array(e)}const Nt=(3+16*ne)*ne,St=(2+12*ne)*ne,kt=(9+64*ne)*ne*ne,ce=xe(4),Be=xe(8),Ue=xe(12),Oe=xe(16),Y=xe(4);function _t(e,r,s,l,a,c,p){let m,x,i,n,o,f,v,y,h,u,b,g,j,N,S,E,k,w;const _=e-a,R=s-a,C=r-c,P=l-c;N=_*P,f=G*_,v=f-(f-_),y=_-v,f=G*P,h=f-(f-P),u=P-h,S=y*u-(N-v*h-y*h-v*u),E=C*R,f=G*C,v=f-(f-C),y=C-v,f=G*R,h=f-(f-R),u=R-h,k=y*u-(E-v*h-y*h-v*u),b=S-k,o=S-b,ce[0]=S-(b+o)+(o-k),g=N+b,o=g-N,j=N-(g-o)+(b-o),b=j-E,o=j-b,ce[1]=j-(b+o)+(o-E),w=g+b,o=w-g,ce[2]=g-(w-o)+(b-o),ce[3]=w;let M=jt(4,ce),z=St*p;if(M>=z||-M>=z||(o=e-_,m=e-(_+o)+(o-a),o=s-R,i=s-(R+o)+(o-a),o=r-C,x=r-(C+o)+(o-c),o=l-P,n=l-(P+o)+(o-c),m===0&&x===0&&i===0&&n===0)||(z=kt*p+yt*Math.abs(M),M+=_*n+P*m-(C*i+R*x),M>=z||-M>=z))return M;N=m*P,f=G*m,v=f-(f-m),y=m-v,f=G*P,h=f-(f-P),u=P-h,S=y*u-(N-v*h-y*h-v*u),E=x*R,f=G*x,v=f-(f-x),y=x-v,f=G*R,h=f-(f-R),u=R-h,k=y*u-(E-v*h-y*h-v*u),b=S-k,o=S-b,Y[0]=S-(b+o)+(o-k),g=N+b,o=g-N,j=N-(g-o)+(b-o),b=j-E,o=j-b,Y[1]=j-(b+o)+(o-E),w=g+b,o=w-g,Y[2]=g-(w-o)+(b-o),Y[3]=w;const B=Ce(4,ce,4,Y,Be);N=_*n,f=G*_,v=f-(f-_),y=_-v,f=G*n,h=f-(f-n),u=n-h,S=y*u-(N-v*h-y*h-v*u),E=C*i,f=G*C,v=f-(f-C),y=C-v,f=G*i,h=f-(f-i),u=i-h,k=y*u-(E-v*h-y*h-v*u),b=S-k,o=S-b,Y[0]=S-(b+o)+(o-k),g=N+b,o=g-N,j=N-(g-o)+(b-o),b=j-E,o=j-b,Y[1]=j-(b+o)+(o-E),w=g+b,o=w-g,Y[2]=g-(w-o)+(b-o),Y[3]=w;const U=Ce(B,Be,4,Y,Ue);N=m*n,f=G*m,v=f-(f-m),y=m-v,f=G*n,h=f-(f-n),u=n-h,S=y*u-(N-v*h-y*h-v*u),E=x*i,f=G*x,v=f-(f-x),y=x-v,f=G*i,h=f-(f-i),u=i-h,k=y*u-(E-v*h-y*h-v*u),b=S-k,o=S-b,Y[0]=S-(b+o)+(o-k),g=N+b,o=g-N,j=N-(g-o)+(b-o),b=j-E,o=j-b,Y[1]=j-(b+o)+(o-E),w=g+b,o=w-g,Y[2]=g-(w-o)+(b-o),Y[3]=w;const O=Ce(U,Ue,4,Y,Oe);return Oe[O-1]}function Et(e,r,s,l,a,c){const p=(r-c)*(s-a),m=(e-a)*(l-c),x=p-m,i=Math.abs(p+m);return Math.abs(x)>=Nt*i?x:-_t(e,r,s,l,a,c,i)}function Ct(e,r){var s,l,a=0,c,p,m,x,i,n,o,f=e[0],v=e[1],y=r.length;for(s=0;s<y;s++){l=0;var h=r[s],u=h.length-1;if(n=h[0],n[0]!==h[u][0]&&n[1]!==h[u][1])throw new Error("First and last coordinates in a ring must be the same");for(p=n[0]-f,m=n[1]-v,l;l<u;l++){if(o=h[l+1],x=o[0]-f,i=o[1]-v,m===0&&i===0){if(x<=0&&p>=0||p<=0&&x>=0)return 0}else if(i>=0&&m<=0||i<=0&&m>=0){if(c=Et(p,x,m,i,0,0),c===0)return 0;(c>0&&i>0&&m<=0||c<0&&i<=0&&m>0)&&a++}n=o,m=i,p=x}}return a%2!==0}var X=63710088e-1,Lt={centimeters:X*100,centimetres:X*100,degrees:360/(2*Math.PI),feet:X*3.28084,inches:X*39.37,kilometers:X/1e3,kilometres:X/1e3,meters:X,metres:X,miles:X/1609.344,millimeters:X*1e3,millimetres:X*1e3,nauticalmiles:X/1852,radians:1,yards:X*1.0936};function Rt(e,r,s={}){const l={type:"Feature"};return(s.id===0||s.id)&&(l.id=s.id),s.bbox&&(l.bbox=s.bbox),l.properties={},l.geometry=e,l}function oe(e,r,s={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!We(e[0])||!We(e[1]))throw new Error("coordinates must contain numbers");return Rt({type:"Point",coordinates:e},r,s)}function Pt(e,r="kilometers"){const s=Lt[r];if(!s)throw new Error(r+" units is invalid");return e*s}function ve(e){return e%360*Math.PI/180}function We(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Me(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mt(e){return e.type==="Feature"?e.geometry:e}function Dt(e,r,s={}){if(!e)throw new Error("point is required");if(!r)throw new Error("polygon is required");const l=Me(e),a=Mt(r),c=a.type,p=r.bbox;let m=a.coordinates;if(p&&$t(l,p)===!1)return!1;c==="Polygon"&&(m=[m]);let x=!1;for(var i=0;i<m.length;++i){const n=Ct(l,m[i]);if(n===0)return!s.ignoreBoundary;n&&(x=!0)}return x}function $t(e,r){return r[0]<=e[0]&&r[1]<=e[1]&&r[2]>=e[0]&&r[3]>=e[1]}var At=Dt;const Tt="https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data/metadonnees/massifs/massifs.geojson",It=[{libSrc:"https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.min.js",workerSrc:"https://unpkg.com/pdfjs-dist@2.16.105/build/pdf.worker.min.js"},{libSrc:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.min.js",workerSrc:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.worker.min.js"},{libSrc:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js",workerSrc:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"}],Ft="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js",st=e=>{const r=[];for(const l of e)/[\p{L}\p{N}]/u.test(l)?r.push(l):(l===" "||l==="-"||l==="_")&&r.push("_");return(r.join("").replace(/^_+|_+$/g,"")||"massif").toUpperCase()},nt=e=>`https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data/bra/BRA_${e.code}_${st(e.massif)}.pdf`,zt=e=>`https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data/bra/BRA_${e.code}_${st(e.massif)}.json`,qe=e=>`https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data/bra/${e}`,Bt=async()=>{if(typeof window>"u")throw new Error("Window unavailable");const e=window;if(e.pdfjsLib)return{pdfjsLib:e.pdfjsLib,workerSrc:e.pdfjsLib.GlobalWorkerOptions.workerSrc};for(const r of It)try{if(await new Promise((s,l)=>{const a=document.createElement("script");a.src=r.libSrc,a.async=!0,a.onload=s,a.onerror=l,document.head.appendChild(a)}),e.pdfjsLib)return e.pdfjsLib.GlobalWorkerOptions.workerSrc=r.workerSrc,{pdfjsLib:e.pdfjsLib,workerSrc:r.workerSrc}}catch{console.warn(`Failed to load PDF.js from ${r.libSrc}`)}throw new Error("All PDF.js sources failed")},Ve=e=>`/bra/danger/${typeof e=="number"?e:"null"}.png`,Ut=e=>typeof e=="number"?`/bra/sat/${e}.webp`:null,de=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Ot=e=>{if(!e)return"-";const r=new Date(e);if(Number.isNaN(r.getTime()))return e;const s=String(r.getDate()).padStart(2,"0"),l=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getFullYear()).slice(-2),c=String(r.getHours()).padStart(2,"0");return`${s}/${l}/${a} Ã  ${c}h`},Wt=e=>{if(!e)return"-";const r=new Date(e);return Number.isNaN(r.getTime())?e:r.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})},qt=(e,r=0)=>{if(!e)return"-";const s=new Date(e);return Number.isNaN(s.getTime())?e:(s.setDate(s.getDate()+r),s.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}))},Vt=(e,r)=>typeof e!="number"||typeof r!="number"?"-":e===r?`${e} cm`:`${e}-${r} cm`,Ht=(e,r)=>{const s=(r||"").trim(),l=(e||"").trim();if(!s)return"";if(!l)return s;const a=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=new RegExp(`^${a}\\s*:?(\\s|\\n)+`,"i");return s.replace(c,"").trim()},He=e=>String(e||"").trim().replace(/^0+/,""),at=()=>typeof navigator>"u"?!1:/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,Jt=()=>{if(typeof navigator>"u")return!1;const e=navigator;if(e.userAgentData&&typeof e.userAgentData.mobile=="boolean")return e.userAgentData.mobile;const r=navigator.userAgent||"";return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(r)||at()},Je=()=>typeof window>"u"?"native":Jt()?"canvas":"native",Gt=({lat:e,lon:r,initialMassifCode:s,onResult:l})=>{const[a,c]=d.useState(null),[p,m]=d.useState(null),x=d.useRef(!1);return d.useRef(void 0),d.useEffect(()=>{(async()=>{try{const n=await fetch(Tt,{cache:"no-cache"});if(!n.ok)throw new Error(`Erreur HTTP ${n.status}`);const o=await n.json();c(o.features)}catch(n){console.error("Failed to load GeoJSON:",n)}})()},[]),d.useEffect(()=>{if(!a)return;const i=oe([r,e]);let n=null;if(s){const o=a.find(f=>He(f.properties.code)===He(s));o&&(n=o.properties)}if(!n){for(const o of a)if(At(i,o)){n=o.properties;break}}m(n),l?.(n),x.current=!0},[e,r,a,s,l]),{features:a,currentMassif:p}};var ot=xt();const Qt=(e,r,s)=>{const[l,a]=d.useState(null),[c,p]=d.useState(!1),[m,x]=d.useState(null);return d.useEffect(()=>{if(!e)return;const i=new AbortController,n=`${zt(e)}${s?`?v=${s}`:""}`;return p(!0),x(null),a(null),fetch(n,{cache:"no-cache",signal:i.signal}).then(async o=>{if(!o.ok)throw new Error(`Erreur HTTP ${o.status}`);return await o.json()}).then(o=>a(o)).catch(o=>{o?.name!=="AbortError"&&(console.error("Erreur de chargement BERA:",o),x("Impossible de charger le BERA pour le moment."))}).finally(()=>p(!1)),()=>i.abort()},[r,e,s]),{beraData:l,beraLoading:c,beraError:m,setBeraError:x}},Yt=(e,r,s)=>{const[l,a]=d.useState(null),[c,p]=d.useState(0),[m,x]=d.useState(0),[i,n]=d.useState(null),[o,f]=d.useState(!1),[v,y]=d.useState(null),h=d.useRef(null),u=d.useRef([]),b=d.useRef(null);return d.useEffect(()=>{if(!r||!e||typeof window>"u")return;const g=new AbortController,j=nt(e);return f(!0),y(null),a(null),p(0),i&&URL.revokeObjectURL(i),n(null),fetch(j,{cache:"no-cache",signal:g.signal}).then(async N=>{if(!N.ok)throw new Error(`Erreur HTTP ${N.status}`);return await N.arrayBuffer()}).then(N=>{if(s==="native"){const S=new Blob([N],{type:"application/pdf"}),E=URL.createObjectURL(S);n(E),f(!1)}else a(new Uint8Array(N))}).catch(N=>{N?.name!=="AbortError"&&(console.error("Erreur de chargement PDF BERA:",N),y("Impossible de charger le PDF pour le moment."),f(!1))}),()=>g.abort()},[r,e,s]),d.useEffect(()=>{r||(i&&typeof window<"u"&&URL.revokeObjectURL(i),n(null))},[r,i]),d.useEffect(()=>{if(s!=="canvas"||!r)return;const g=h.current;if(!g)return;const j=()=>{x(g.clientWidth||0)};if(j(),typeof ResizeObserver>"u")return;const N=new ResizeObserver(()=>j());return N.observe(g),()=>N.disconnect()},[r,s]),d.useEffect(()=>{if(s!=="canvas"||!r||!l)return;let g=!1;return Bt().then(({pdfjsLib:j,workerSrc:N})=>{j.GlobalWorkerOptions.workerSrc=N;const S=at();return j.getDocument({data:l,disableWorker:S}).promise}).then(j=>{g||(b.current=j,p(j.numPages||0))}).catch(j=>{g||(console.error("Erreur PDF.js:",j),y("Impossible d'afficher le PDF pour le moment."),f(!1))}),()=>{g=!0,b.current=null}},[l,s,r]),d.useEffect(()=>{if(s!=="canvas"||!r)return;const g=b.current;if(!g||!m||c===0)return;let j=!1;return(async()=>{await new Promise(S=>requestAnimationFrame(S));for(let S=1;S<=c;S+=1){if(j)return;const E=u.current[S-1];if(!E)continue;const k=await g.getPage(S);if(j)return;const w=k.getViewport({scale:1}),_=m/w.width,R=Math.min(3,window.devicePixelRatio||1),C=k.getViewport({scale:_}),P=k.getViewport({scale:_*R}),M=E.getContext("2d");M&&(E.style.width=`${C.width}px`,E.style.height=`${C.height}px`,E.width=Math.ceil(P.width),E.height=Math.ceil(P.height),await k.render({canvasContext:M,viewport:P}).promise)}})().catch(S=>{j||(console.error("Erreur rendu PDF:",S),y("Impossible d'afficher le PDF pour le moment."))}).finally(()=>{j||f(!1)}),()=>{j=!0}},[c,m,l,s,r]),{beraPdfData:l,beraPdfPageCount:c,beraPdfWidth:m,beraPdfBlobUrl:i,beraPdfLoading:o,beraPdfError:v,beraPdfContainerRef:h,beraPdfCanvasRefs:u}},Zt=()=>{if(typeof window>"u")return Promise.reject(new Error("Chart.js unavailable"));if(window.Chart){const e=window.Chart;return e?.register&&e.registerables,Promise.resolve(e)}return new Promise((e,r)=>{const s=document.querySelector("script[data-chartjs-bera]");if(s){s.addEventListener("load",()=>e(window.Chart)),s.addEventListener("error",()=>r(new Error("Failed to load Chart.js")));return}const l=document.createElement("script");l.src=Ft,l.async=!0,l.setAttribute("data-chartjs-bera","true"),l.onload=()=>e(window.Chart),l.onerror=()=>r(new Error("Failed to load Chart.js")),document.head.appendChild(l)})},Xt=(e,r)=>{const s=d.useRef(null),l=d.useRef(null);return d.useEffect(()=>{const a=s.current,c=(r?.evalbra?.precip_cumulated?.fresh_snow_24h||[]).slice(-6),p=Math.max(0,...c.map(i=>Math.max(typeof i.max_cm=="number"?i.max_cm:0,typeof i.rain_mm=="number"?i.rain_mm:0))),m=Math.max(10,Math.ceil(p/10)*10);if(!a||c.length===0){l.current&&(l.current.destroy(),l.current=null);return}let x=!1;return Zt().then(i=>{if(x||!a||!i)return;if(i.register&&i.registerables)try{i.register(...i.registerables)}catch{}l.current&&(l.current.destroy(),l.current=null);const n=c.map((k,w)=>k.date?[Wt(k.date)]:[`J+${w+1}`]);l.current=new i(a,{type:"bar",data:{labels:n,datasets:[{label:"Neige fraiche Min",data:c.map(k=>typeof k.min_cm=="number"?k.min_cm:0),backgroundColor:"#a3e635",borderRadius:2},{label:"Neige fraiche Max",data:c.map(k=>typeof k.max_cm=="number"?k.max_cm:0),backgroundColor:"#15803d",borderRadius:2},{label:"Pluie",data:c.map(k=>typeof k.rain_mm=="number"?k.rain_mm:0),backgroundColor:"#4f46e5",borderRadius:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{ticks:{color:"#cbd5f5",font:{size:10},maxRotation:0},grid:{color:"rgba(148,163,184,0.2)"},border:{color:"rgba(148,163,184,0.5)"}},y:{beginAtZero:!0,suggestedMax:m,ticks:{color:"#cbd5f5",font:{size:10}},grid:{color:"rgba(148,163,184,0.2)"},border:{color:"rgba(148,163,184,0.5)"}}},plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},interaction:{mode:"index",intersect:!1}}});let o=!1,f=0,v=0,y=!1,h=!1;const u=12,b=6,g=()=>{const k=l.current;k&&(k.tooltip?.setActiveElements([],{x:0,y:0}),k.setActiveElements([]),k.update())},j=k=>{o=!0,f=k.clientX,v=k.clientY,y=!1,h=!1},N=k=>{if(!o)return;const w=Math.abs(k.clientX-f),_=Math.abs(k.clientY-v);(_>u||w>u)&&(_>=w-b?(y=!0,h=!0,g()):h=!0)},S=()=>{o=!1},E=k=>{(h||y)&&(k.preventDefault(),k.stopImmediatePropagation(),h=!1)};a.addEventListener("pointerdown",j),a.addEventListener("pointermove",N),a.addEventListener("pointerup",S),a.addEventListener("pointerleave",S),a.addEventListener("pointercancel",S),a.addEventListener("click",E,!0),l.current._cleanup=()=>{a.removeEventListener("pointerdown",j),a.removeEventListener("pointermove",N),a.removeEventListener("pointerup",S),a.removeEventListener("pointerleave",S),a.removeEventListener("pointercancel",S),a.removeEventListener("click",E,!0)}}).catch(console.error),()=>{x=!0,l.current&&(l.current._cleanup&&l.current._cleanup(),l.current.destroy(),l.current=null)}},[e,r]),{precipChartRef:s}},Kt=(e,r)=>{if(!e)return"";const s=r?.showSideLabels??!1,l=r?.showSplitLabel??!0,a=e.zones||{},c=a.top?.text??"",p=a.bottom?.text??"",m=a.left?.text??"",x=a.right?.text??"",i=a.center?.text??"",n=e.split?.axis??null,o=e.split?.label?de(e.split.label):"",f=n==="horizontal"?'<line x1="32" y1="64" x2="160" y2="64" stroke="currentColor" stroke-width="2.5"/>':n==="vertical"?'<line x1="100" y1="28" x2="100" y2="110" stroke="currentColor" stroke-width="2.5"/>':"",v=18,h=l&&n==="horizontal"&&o?`<text x="228" y="64" font-size="18" text-anchor="end">${o}</text>`:"",u=[],b=6;i?u.push(`<text x="${100+b}" y="86" font-size="${v}" text-anchor="middle">${de(i)}</text>`):n==="horizontal"?(c&&u.push(`<text x="${100+b}" y="52" font-size="${v}" text-anchor="middle">${de(c)}</text>`),p&&u.push(`<text x="${100+b}" y="98" font-size="${v}" text-anchor="middle">${de(p)}</text>`)):n==="vertical"&&(m&&u.push(`<text x="${71+b}" y="86" font-size="${v}" text-anchor="middle">${de(m)}</text>`),x&&u.push(`<text x="${129+b}" y="86" font-size="${v}" text-anchor="middle">${de(x)}</text>`),s&&(u.push('<text x="26" y="45" font-size="16">O</text>'),u.push('<text x="170" y="45" font-size="16">E</text>')));const g=s&&n==="horizontal"&&!i?'<text x="18" y="45" font-size="16">N</text><text x="175" y="45" font-size="16">S</text>':"";return`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 120">
  <g stroke="currentColor" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round" fill="none">
    <path d="M10 110 L58 40 L86 42 L110 10 L190 110 Z"/>
    ${f}
  </g>
  <g fill="currentColor" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial" font-weight="600">
    ${u.join(`
    `)}
    ${h}
    ${g}
  </g>
</svg>`.trim()},er=({pictogram:e,localizationType:r,isMobileViewport:s})=>t.jsx("div",{role:"img","aria-label":"Localisation du risque",className:"w-44 h-24 sm:w-52 sm:h-28 text-[var(--text-main)] mx-auto",dangerouslySetInnerHTML:{__html:Kt(e,{showSideLabels:r==="north_south"||r==="east_west",showSplitLabel:!s})}}),tr=({canvasRef:e})=>t.jsx("div",{className:"h-40 sm:h-48 border border-dashed border-[var(--border)] rounded-lg bg-[var(--input-bg)]/40 px-2 py-2",children:t.jsx("canvas",{ref:e,className:"w-full h-full",style:{touchAction:"pan-y"}})}),rr=({beraData:e,currentMassif:r,isMobileViewport:s,precipChartRef:l})=>{const a=e?.evalbra||null,c=a?.risk||null,p=c?.max_level??null,m=c?.localization?.threshold_m??null;a?.dangerous_aspects?.aspects;const x=a?.dangerous_aspects?.image?.filename??null,i=a?.sat||null,n=a?.precip_cumulated||null,o=a?.stability||null,f=a?.snow_quality||null,v=a?.snowpack||null,y=c?.j2||null,h=x?qe(x):null,u=v?.image?.filename?qe(v.image.filename):null,b=(n?.fresh_snow_24h||[]).slice(-6);return t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsxs("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[t.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_minmax(0,2fr)] gap-3 sm:contents",children:[t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2 order-1 sm:order-1",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Echelle d'indice de risque"}),t.jsx("div",{className:"flex items-center justify-center gap-3",children:t.jsx("img",{src:Ve(p),alt:"Indice de risque",className:"h-14 w-14 sm:h-16 sm:w-16 object-contain"})}),t.jsx("div",{className:"text-sm font-semibold text-[var(--text-main)] text-center",children:typeof p=="number"?`Niveau ${p}`:"-"})]}),t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2 order-2 sm:order-4",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Situations avalancheuses typiques (SAT)"}),(()=>{const g=i?.labels||{},j=[i?.primary,i?.secondary].filter(N=>typeof N=="number");return j.length?t.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(N=>{const S=Ut(N);return t.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-[var(--border)] bg-[var(--input-bg)]/60 px-2.5 py-1.5",children:[S&&t.jsx("img",{src:S,alt:`SAT ${N}`,className:"h-8 w-8 object-contain"}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-[10px] text-[var(--text-muted)]",children:["SAT ",N]}),t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-main)] leading-normal",children:g[String(N)]||`SAT ${N}`})]})]},`sat-${N}`)})}):t.jsx("div",{className:"text-sm text-[var(--text-muted)]",children:"-"})})()]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:contents",children:[t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2 order-3 sm:order-2",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Localisation des indices de risque"}),c?.pictogram?t.jsxs("div",{className:"space-y-2",children:[t.jsx(er,{pictogram:c.pictogram,localizationType:c?.localization?.type,isMobileViewport:s}),t.jsxs("div",{className:"text-xs sm:text-sm text-[var(--text-muted)] space-y-2 leading-normal",children:[typeof m=="number"&&t.jsxs("div",{children:["Seuil :"," ",t.jsxs("span",{className:"text-[var(--text-main)] font-medium",children:[m," m"]})]}),c?.comment&&t.jsx("div",{className:"whitespace-pre-line text-justify",children:c.comment})]})]}):t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-muted)]",children:"-"})]}),t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2 order-4 sm:order-3",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Orientations les plus dangereuses"}),t.jsx("div",{className:"space-y-2",children:h?t.jsx("div",{className:"flex justify-center",children:t.jsx("img",{src:h,alt:"Rose des pentes",className:"w-full max-w-sm max-h-40 sm:max-h-48 object-contain"})}):t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-muted)]",children:"-"})})]})]})]}),t.jsxs("div",{className:"grid gap-3 sm:gap-4 lg:grid-cols-2 items-stretch",children:[t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Precipitations cumulees"}),typeof n?.reference_altitude_m=="number"&&t.jsxs("div",{className:"text-xs text-[var(--text-muted)]",children:["Ref ",n.reference_altitude_m," m"]})]}),n?.totals&&typeof n.totals.last_48h_min_cm=="number"&&typeof n.totals.last_48h_max_cm=="number"&&t.jsxs("div",{className:"text-sm text-[var(--text-muted)]",children:["Cumul 48h :"," ",t.jsx("span",{className:"font-semibold text-[var(--text-main)]",children:Vt(n.totals.last_48h_min_cm,n.totals.last_48h_max_cm)})]}),t.jsxs("div",{className:"flex flex-nowrap items-start gap-2 sm:gap-4 text-[11px] text-[var(--text-muted)]",children:[t.jsxs("span",{className:"inline-flex items-start gap-2",children:[t.jsx("span",{className:"h-3 w-6 rounded-full bg-lime-400"}),t.jsxs("span",{className:"leading-tight text-center",children:["Neige fraiche ",t.jsx("span",{className:"block sm:hidden",children:"Min"}),t.jsx("span",{className:"hidden sm:inline",children:" Min"})]})]}),t.jsxs("span",{className:"inline-flex items-start gap-2",children:[t.jsx("span",{className:"h-3 w-6 rounded-full bg-green-700"}),t.jsxs("span",{className:"leading-tight text-center",children:["Neige fraiche ",t.jsx("span",{className:"block sm:hidden",children:"Max"}),t.jsx("span",{className:"hidden sm:inline",children:" Max"})]})]}),t.jsxs("span",{className:"inline-flex items-center gap-2",children:[t.jsx("span",{className:"h-3 w-6 rounded-full bg-indigo-600"}),t.jsx("span",{children:"Pluie"})]})]}),b.length>0?t.jsxs("div",{className:"space-y-2",children:[t.jsx(tr,{canvasRef:l}),t.jsx("div",{className:"text-[11px] text-[var(--text-muted)]",children:"Neige (cm) / Pluie (mm)"})]}):t.jsx("div",{className:"text-sm text-[var(--text-muted)]",children:"Aucune donnÃ©e 24h disponible."})]}),t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Stabilite du manteau neigeux"}),o?.title&&t.jsx("div",{className:"text-sm font-semibold text-[var(--text-main)] leading-normal",children:o.title}),(()=>{const g=[{key:"triggered",label:"Declenchements provoques",data:o?.sections?.triggered},{key:"spontaneous",label:"Departs spontanes",data:o?.sections?.spontaneous},{key:"other",label:"Autres",data:o?.sections?.other}];return g.some(N=>N.data?.text||N.data?.title)?t.jsx("div",{className:"grid gap-2 sm:grid-cols-2 xl:grid-cols-3",children:g.map(N=>t.jsxs("div",{className:"rounded-lg border border-[var(--border)]/60 bg-[var(--input-bg)]/60 p-2.5 sm:p-3 space-y-1",children:[t.jsx("div",{className:"text-[10px] uppercase tracking-wide text-[var(--text-muted)]",children:N.label}),N.data?.title&&t.jsx("div",{className:"text-xs font-semibold text-[var(--text-main)]",children:N.data.title}),t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-main)] whitespace-pre-line leading-normal text-justify",children:N.data?.text||"-"})]},N.key))}):t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-muted)] whitespace-pre-line leading-normal text-justify",children:Ht(o?.title,o?.text)||"-"})})()]}),t.jsxs("div",{className:"sm:col-span-2 lg:col-span-2 grid gap-3 sm:gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1.4fr)_minmax(0,0.6fr)] items-stretch",children:[t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm h-full flex flex-col",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Qualite de la neige"}),t.jsx("div",{className:"flex-1 mt-2",children:t.jsxs("div",{className:"grid gap-2 sm:gap-3",children:[t.jsxs("div",{className:"rounded-lg border border-[var(--border)]/60 bg-[var(--input-bg)]/60 p-2.5 sm:p-3 space-y-1",children:[t.jsx("div",{className:"text-[10px] uppercase tracking-wide text-[var(--text-muted)]",children:"Altitudes skiables"}),t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-main)]",children:v?.limits_m&&(typeof v.limits_m.north=="number"||typeof v.limits_m.south=="number")?t.jsxs(t.Fragment,{children:[typeof v.limits_m.north=="number"?`N ${v.limits_m.north} m`:"N -"," / ",typeof v.limits_m.south=="number"?`S ${v.limits_m.south} m`:"S -"]}):"-"})]}),t.jsxs("div",{className:"rounded-lg border border-[var(--border)]/60 bg-[var(--input-bg)]/60 p-2.5 sm:p-3 space-y-1",children:[t.jsx("div",{className:"text-[10px] uppercase tracking-wide text-[var(--text-muted)]",children:"Types de neige"}),t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-main)] whitespace-pre-line leading-normal text-justify",children:f?.text||"-"})]})]})})]}),t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2 h-full",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:"Enneigement"}),t.jsx("div",{className:"flex-1 mt-2",children:u?t.jsx("div",{className:"flex justify-center",children:t.jsx("img",{src:u,alt:"Enneigement",className:"w-full max-w-3xl max-h-56 sm:max-h-72 object-contain"})}):t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-muted)]",children:"-"})})]}),t.jsxs("div",{className:"border border-[var(--border)] rounded-[var(--radius)] p-3 sm:p-4 bg-[var(--card-bg)] shadow-sm space-y-2 h-full",children:[t.jsxs("div",{className:"text-xs uppercase tracking-wide text-[var(--text-muted)]",children:["Tendance du ",qt(e?.bulletin?.valid_until??null,1)]}),t.jsx("div",{className:"flex-1 mt-2",children:y?t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx("img",{src:Ve(y.max_level??null),alt:"Indice de risque demain",className:"h-14 w-14 sm:h-16 sm:w-16 object-contain"})}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--text-main)] text-center",children:typeof y.max_level=="number"?`Niveau ${y.max_level}`:"-"}),t.jsx("div",{className:"text-xs text-[var(--text-muted)] text-justify",children:y.trend==="up"?"Tendance en hausse":y.trend==="down"?"Tendance en baisse":y.trend==="steady"?"Tendance stable":"Tendance inconnue"}),y.comment&&t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-muted)] whitespace-pre-line leading-normal text-justify",children:y.comment})]})]}):t.jsx("div",{className:"text-xs sm:text-sm text-[var(--text-muted)]",children:"-"})})]})]})]})]})},sr=({currentMassif:e,onClose:r,portalTarget:s,isMobileViewport:l,initialOpenPdf:a=!1})=>{const c=d.useRef(null),p=d.useRef(null),[m,x]=d.useState(0),[i,n]=d.useState(a),[o,f]=d.useState(Je()),{beraData:v,beraLoading:y,beraError:h}=Qt(e,!0,m),{beraPdfLoading:u,beraPdfError:b,beraPdfBlobUrl:g,beraPdfContainerRef:j,beraPdfCanvasRefs:N,beraPdfPageCount:S}=Yt(e,i,o),{precipChartRef:E}=Xt(!0,v),k=nt(e);return d.useEffect(()=>{const w=R=>R.stopPropagation(),_=c.current;return _&&(_.addEventListener("mousedown",w),_.addEventListener("touchstart",w,{passive:!0})),()=>{_&&(_.removeEventListener("mousedown",w),_.removeEventListener("touchstart",w))}},[]),d.useEffect(()=>{if(!i)return;const w=R=>R.stopPropagation(),_=p.current;return _&&(_.addEventListener("mousedown",w),_.addEventListener("touchstart",w,{passive:!0})),()=>{_&&(_.removeEventListener("mousedown",w),_.removeEventListener("touchstart",w))}},[i]),ot.createPortal(t.jsxs("div",{ref:c,className:"fixed inset-0 z-[6000] bg-black/80 backdrop-blur-sm",onClick:w=>w.target===w.currentTarget&&r(),children:[t.jsxs("div",{className:"flex h-full w-full flex-col bg-[var(--card-bg)]",onClick:w=>w.stopPropagation(),onPointerDown:w=>w.stopPropagation(),children:[t.jsx("div",{className:"flex flex-row items-center justify-between px-3 sm:px-4 py-2 sm:py-3 bg-[var(--card-bg)]/95 border-b border-[var(--border)] gap-2 sm:gap-3 relative",children:t.jsxs("div",{className:"flex items-center gap-1 justify-between w-full",children:[t.jsx("div",{className:"space-y-1",children:t.jsxs("div",{className:"text-base sm:text-lg font-semibold leading-tight text-[var(--text-main)]",children:["BERA - ",e.massif]})}),t.jsx("button",{onClick:w=>{w.stopPropagation(),w.preventDefault(),r()},onPointerDown:w=>w.stopPropagation(),className:"p-2 text-[var(--text-muted)] hover:text-[var(--text-main)] hover:bg-[var(--hover-bg)] active:bg-[rgba(55,65,81,0.95)] rounded-lg transition-all","aria-label":"Fermer",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})}),t.jsxs("div",{className:"px-3 sm:px-4 lg:px-6 py-2 bg-[var(--card-bg)] text-xs text-[var(--text-muted)] flex flex-wrap gap-x-3 gap-y-1",children:[v?.bulletin?.valid_until&&t.jsxs("span",{children:["Valable jusqu'au ",Ot(v.bulletin.valid_until)]}),t.jsx("button",{type:"button",onClick:()=>{f(Je()),n(!0)},className:"hover:text-[var(--text-main)] transition-colors underline decoration-dotted text-left",children:"Version PDF MÃ©tÃ©o-France"})]}),t.jsxs("div",{className:"relative flex-1 overflow-y-auto p-3 sm:p-4 lg:p-6 bg-[var(--card-bg)] leading-normal",style:{paddingBottom:"calc(0.75rem + env(safe-area-inset-bottom, 0px))"},children:[y&&t.jsx("div",{className:"absolute inset-0 bg-[var(--card-bg)]/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("img",{src:"/logo/flocon-white.svg",alt:"",className:"loading-spinner"}),t.jsx("p",{children:"Chargement du BERA..."})]})}),h&&!y&&t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("p",{className:"text-red-600 font-medium",children:h}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2",children:[t.jsx("button",{onClick:()=>x(Date.now()),className:"px-4 py-2 bg-[var(--primary)] text-white rounded-lg hover:bg-[var(--primary-hover)] transition-colors",children:"RÃ©essayer"}),t.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-[var(--input-bg)] border border-[var(--border)] rounded-lg hover:border-[var(--primary)] transition-colors",children:"Ouvrir le PDF"})]})]}),!h&&!y&&v&&t.jsx(rr,{beraData:v,currentMassif:e,isMobileViewport:l,precipChartRef:E})]})]}),i&&t.jsx("div",{ref:p,className:"fixed inset-0 z-[6500] bg-black/80 backdrop-blur-sm",onClick:w=>w.target===w.currentTarget&&n(!1),children:t.jsx("div",{className:"flex h-full w-full flex-col",onClick:w=>w.stopPropagation(),onPointerDown:w=>w.stopPropagation(),children:t.jsxs("div",{className:"relative flex-1 min-h-0 bg-black",children:[u&&t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm z-10 flex flex-col items-center justify-center text-white",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("img",{src:"/logo/flocon-white.svg",alt:"",className:"loading-spinner"}),t.jsx("p",{children:"Chargement du PDF..."})]})}),b&&!u&&t.jsxs("div",{className:"absolute inset-0 bg-black/70 z-10 flex flex-col items-center justify-center gap-3 text-center p-4 text-white",children:[t.jsx("p",{className:"font-medium",children:b}),t.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-[var(--primary)] text-white rounded-lg hover:bg-[var(--primary-hover)] transition-colors",children:"Ouvrir le PDF"})]}),o==="native"&&g&&t.jsx("object",{data:g,type:"application/pdf",className:"w-full h-full",children:t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-sm text-white/80 gap-2",children:[t.jsx("span",{children:"Affichage intÃ©grÃ© non supportÃ©."}),t.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Ouvrir le PDF"})]})}),o==="canvas"&&t.jsx("div",{ref:j,className:"h-full w-full overflow-y-auto overflow-x-hidden bg-gray-900 scroll-smooth p-2 sm:p-4 space-y-4",style:{WebkitOverflowScrolling:"touch"},children:Array.from({length:S}).map((w,_)=>t.jsx("canvas",{ref:R=>{N.current[_]=R},className:"mx-auto shadow-2xl bg-white max-w-full block"},`page-${_+1}`))})]})})})]}),s)},nr=(e,r,s,l=3)=>{const[a,c]=d.useState(null),[p,m]=d.useState(!1),[x,i]=d.useState(null);return d.useEffect(()=>{(async()=>{m(!0),i(null);try{const o=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${r}&hourly=temperature_2m,precipitation,snowfall,weather_code,cloud_cover,cloud_cover_low,cloud_cover_mid,cloud_cover_high,visibility,wind_speed_10m,wind_gusts_10m,freezing_level_height&timezone=auto&forecast_days=${l}`,f=await fetch(o);if(!f.ok)throw new Error(`Failed to fetch forecast: ${f.statusText}`);const v=await f.json();c(v)}catch(o){console.error("Error fetching forecast:",o),i(o instanceof Error?o.message:"Unable to fetch forecast data")}finally{m(!1)}})()},[e,r,s,l]),{data:a,loading:p,error:x}},ar=[{key:"precip",label:"PrÃ©cipitations",unit:"",color:"#3b82f6",baselineZero:!0},{key:"temp",label:"TempÃ©rature",unit:"Â°C",color:"#f97316",baselineZero:!0,tempPalette:{pos:"#ef4444",neg:"#2563eb"}},{key:"iso0",label:"Isotherme 0Â°C",unit:"m",color:"#60a5fa",baselineZero:!1},{key:"wind",label:"Vent",unit:"km/h",color:"#10b981",baselineZero:!0},{key:"visibility",label:"VisibilitÃ©",unit:"m",color:"#a855f7",baselineZero:!0},{key:"total_clouds",label:"Couverture nuageuse totale",unit:"%",color:"#94a3b8",baselineZero:!0},{key:"clouds",label:"Nuage en fonction de l'altitude (km)",unit:"%",color:"#94a3b8",baselineZero:!0}],or={0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸ˜¶â€ğŸŒ«ï¸",48:"ğŸ˜¶â€ğŸŒ«ï¸",51:"ğŸŒ¦ï¸",53:"ğŸŒ¦ï¸",55:"ğŸŒ¦ï¸",61:"ğŸŒ§ï¸",63:"ğŸŒ§ï¸",65:"ğŸŒ§ï¸",71:"â„ï¸",73:"â„ï¸",75:"â„ï¸",77:"â„ï¸",80:"ğŸŒ¦ï¸",81:"ğŸŒ¦ï¸",82:"ğŸŒ¦ï¸",85:"ğŸŒ¨ï¸",86:"ğŸŒ¨ï¸",95:"â›ˆï¸",96:"â›ˆï¸",99:"â›ˆï¸"},Ge={0:"ğŸŒ™",1:"â˜ï¸",2:"â˜ï¸"},ir="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js",lr="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js";function cr(e,r){return(r<6||r>=21)&&Ge[e]?Ge[e]:or[e]||"â“"}function dr({data:e,days:r}){const s=e.hourly.time;if(!s.length)return null;const l=e.hourly.weather_code||[],a=new Date(s[0]).getTime(),p=new Date(s[s.length-1]).getTime()-a,m=s.map((x,i)=>({time:new Date(x),code:l[i]??0})).filter(x=>{const i=x.time.getHours();return r===1?i%3===0:r===3?i===10||i===15||i===0:i===12});return t.jsx("div",{className:"relative h-14 mb-2 border-b border-[var(--border)]",style:{marginLeft:"45px",marginRight:"15px"},children:m.map((x,i)=>{const n=(x.time.getTime()-a)/p*100,o=x.time.getHours(),f=r<7&&(o===0||i===0)||r>=7&&o===12;return t.jsxs("div",{className:"absolute -translate-x-1/2 flex flex-col items-center",style:{left:`${n}%`},children:[f&&t.jsx("span",{className:"text-[8px] text-[var(--primary)] font-bold uppercase mb-0.5 whitespace-nowrap",children:x.time.toLocaleDateString("fr-FR",{weekday:"short"}).replace(".","")}),!f&&r>=7&&t.jsx("div",{className:"h-[12px]"}),t.jsx("span",{className:"text-lg leading-none",children:cr(x.code,o)}),r<7&&t.jsxs("span",{className:"text-[9px] text-[var(--text-muted)] font-medium",children:[o,"h"]})]},i)})})}let we=null,ye=null,Qe=!1;async function ur(){return we||(we=new Promise((e,r)=>{if(typeof window>"u"){e(null);return}if(window.Chart){e(window.Chart);return}const s=document.createElement("script");s.src=ir,s.async=!0,s.onload=()=>e(window.Chart),s.onerror=()=>r(new Error("Failed to load Chart.js")),document.head.appendChild(s)}),we.then(e=>(e&&e.register&&e.registerables&&!Qe&&(e.register(...e.registerables),Qe=!0),e)))}async function mr(){return ye||(ye=new Promise((e,r)=>{if(typeof window>"u"){e();return}if(window.Chart&&window.Chart._adapters?.date){e();return}const s=document.createElement("script");s.src=lr,s.async=!0,s.onload=()=>e(),s.onerror=()=>r(new Error("Failed to load Chart.js date adapter")),document.head.appendChild(s)}),ye)}async function fr(){const e=await ur();return await mr(),e}const pr=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),hr=new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit"}),xr={id:"clickLine",afterDraw(e){const r=e.$clickLineX;if(r==null)return;const{ctx:s,chartArea:l}=e;!l||r<l.left||r>l.right||(s.save(),s.strokeStyle="rgba(255,255,255,0.35)",s.lineWidth=1,s.beginPath(),s.moveTo(r,l.top),s.lineTo(r,l.bottom),s.stroke(),s.restore())}};function gr({data:e,seriesKey:r,color:s,baselineZero:l,tempPalette:a,label:c,unit:p,days:m,interactionEnabled:x}){const i=d.useRef(null),n=d.useRef(null),[o,f]=d.useState(null),[v,y]=d.useState(!1),h=d.useRef(!0);d.useEffect(()=>{h.current=x},[x]),d.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const b=window.matchMedia("(pointer: coarse)"),g=()=>y(b.matches);return g(),b.addEventListener&&b.addEventListener("change",g),()=>{b.removeEventListener&&b.removeEventListener("change",g)}},[]);const u=d.useMemo(()=>{const b=e.hourly.time;return r==="temp"?b.map((g,j)=>({x:new Date(g),y:e.hourly.temperature_2m?.[j]??null})):r==="wind"?b.map((g,j)=>({x:new Date(g),y:e.hourly.wind_speed_10m?.[j]??null,gust:e.hourly.wind_gusts_10m?.[j]??null})):r==="precip"?b.map((g,j)=>({x:new Date(g),y:e.hourly.precipitation?.[j]??null,snow:e.hourly.snowfall?.[j]??null})):r==="visibility"?b.map((g,j)=>({x:new Date(g),y:e.hourly.visibility?.[j]??null})):r==="total_clouds"?b.map((g,j)=>({x:new Date(g),y:e.hourly.cloud_cover?.[j]??null})):r==="iso0"?b.map((g,j)=>({x:new Date(g),y:e.hourly.freezing_level_height?.[j]??null})):r==="clouds"?b.map((g,j)=>({x:new Date(g),y:e.hourly.cloud_cover?.[j]??null,low:e.hourly.cloud_cover_low?.[j]??null,mid:e.hourly.cloud_cover_mid?.[j]??null,high:e.hourly.cloud_cover_high?.[j]??null})):[]},[e,r]);return d.useEffect(()=>{let b=!1;return(async()=>{try{const j=await fr();if(b||!j||!i.current)return;n.current&&n.current.destroy();const N=[];if(r==="temp")N.push({label:`${c} (${p})`,data:u,borderColor:a?a.pos:s,backgroundColor:a?a.pos+"33":s+"33",borderWidth:2,pointRadius:0,tension:.3,cubicInterpolationMode:"monotone",fill:a?{target:"origin",above:a.pos+"33",below:a.neg+"33"}:!0,segment:a?{borderColor:w=>{const _=w?.p0?.parsed?.y,R=w?.p1?.parsed?.y;return!Number.isFinite(_)||!Number.isFinite(R)||_>=0&&R>=0?a.pos:_<0&&R<0?a.neg:a.pos}}:void 0});else if(r==="wind")N.push({label:`${c} (${p})`,data:u,borderColor:s,backgroundColor:s+"33",borderWidth:2,pointRadius:0,tension:.3,fill:!0,yAxisID:"y"}),N.push({label:`Rafales (${p})`,data:u.map(w=>({x:w.x,y:w.gust})),borderColor:"#0ea5e9",backgroundColor:"transparent",borderWidth:2,pointRadius:0,tension:.3,yAxisID:"y1"});else if(r==="precip")N.push({label:"Pluie (mm)",data:u,borderColor:"#3b82f6",backgroundColor:"#3b82f644",borderWidth:2,tension:.3,fill:!0,pointRadius:0,yAxisID:"y"}),N.push({label:"Neige (cm)",data:u.map(w=>({x:w.x,y:w.snow})),borderColor:"#ffffff",backgroundColor:"#ffffff44",borderWidth:2,tension:.3,fill:!0,pointRadius:0,yAxisID:"y1"});else if(r==="visibility"||r==="total_clouds"||r==="iso0")N.push({label:`${c} (${p})`,data:u,borderColor:s,backgroundColor:r==="iso0"?"transparent":s+"44",borderWidth:2,tension:.3,fill:r!=="iso0",pointRadius:0});else if(r==="clouds"){const w=(e.elevation||0)/1e3;[{key:"high",label:"Haut",color:"#cbd5e1",range:[6,12]},{key:"mid",label:"Moyen",color:"#94a3b8",range:[2,6]},{key:"low",label:"Bas",color:"#64748b",range:[0,2]}].reverse().forEach(R=>{const[C,P]=R.range;N.push({label:`${R.label} (%)`,data:u.map(M=>({x:M.x,y:[Math.max(w,C),Math.max(w,P)],value:M[R.key]})),backgroundColor:M=>{const z=M.raw?.value??0,B=Math.round(z/100*200+20).toString(16).padStart(2,"0");return R.color+B},borderWidth:0,barPercentage:1,categoryPercentage:1})})}const S=u.length?u[0].x.getTime():void 0,E=u.length?u[u.length-1].x.getTime():void 0;n.current=new j(i.current,{type:r==="clouds"?"bar":"line",data:{datasets:N},plugins:[xr],options:{events:["mousemove","mouseout","click"],responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",bounds:"data",min:S,max:E,time:{unit:"hour",stepSize:3,tooltipFormat:"dd/MM HH:mm",displayFormats:{hour:m===1?"HH'h'":"HH:mm",day:"dd/MM"}},afterBuildTicks:w=>{if(m===1)return;const _=w.ticks||[];if(!_.length)return;const R=[],C=new Set;_.forEach(P=>{const M=new Date(P.value);C.add(M.toISOString().slice(0,10))}),C.forEach(P=>{const M=new Date(`${P}T12:00:00.000Z`).getTime();_.some(B=>Math.abs(B.value-M)<1)||R.push({value:M,major:!1})}),R.length&&(w.ticks=[..._,...R].sort((P,M)=>P.value-M.value))},ticks:{autoSkip:!1,maxRotation:0,major:{enabled:!0},callback:(w,_,R)=>{const C=typeof w=="number"?w:Number(w);if(!Number.isFinite(C))return"";const P=R?.[_],M=new Date(C),z=`${String(M.getHours()).padStart(2,"0")}h`;if(m===1)return z;const B=hr.format(M);return v&&m>1||!v&&m>=7?P?.major?B:"":P?.major?`${B}
${z}`:z},color:"#ffffff",font:{size:10}},grid:{color:w=>w.tick?.major?"rgba(255,255,255,0.18)":"rgba(255,255,255,0.08)",lineWidth:w=>w.tick?.major?1:.5}},y:{stacked:!1,beginAtZero:r!=="clouds",min:r==="clouds"?(e.elevation||0)/1e3:void 0,max:r==="clouds"?12:void 0,ticks:{color:"#ffffff",font:{size:10},callback:function(w){if(r==="clouds"){const _=(e.elevation||0)/1e3;return Math.abs(w-_)<.01?_.toFixed(1):w===2?"2":w===6?"6":w===12?"12":""}return w}},grid:{color:w=>r==="clouds"?[2,6,12].includes(w.tick.value)?"rgba(255,255,255,0.2)":"transparent":r==="temp"&&w.tick.value===0?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.1)",lineWidth:w=>r==="temp"&&w.tick.value===0?1.5:r==="clouds"&&[2,6,12].includes(w.tick.value)?1:.5},title:r==="precip"?{display:!0,text:"mm",color:"#3b82f6",font:{size:9,weight:"bold"}}:void 0},...r==="precip"||r==="wind"?{y1:{type:"linear",position:"right",beginAtZero:!0,grid:{display:!1},ticks:{color:"#ffffff",font:{size:10}},title:r==="precip"?{display:!0,text:"cm",color:"#ffffff",font:{size:9,weight:"bold"}}:void 0}}:{}},plugins:{legend:{display:N.length>1&&r!=="clouds"},tooltip:{intersect:!1,mode:"index",callbacks:{title:w=>{const _=w?.[0],R=_?.parsed?.x;return typeof R=="number"?pr.format(new Date(R)):_?.label||""},label:w=>{if(r==="clouds")return`${w.dataset.label} : ${w.raw.value}%`;if(r==="precip"){const _=w.dataset.label.includes("Neige")?"cm":"mm";return`${w.dataset.label} : ${w.formattedValue} ${_}`}return`${w.dataset.label} : ${w.formattedValue}${p}`}}}}}});const k=i.current;if(k){let w=!1,_=0,R=0,C=!1,P=!1,M=!1;const z=12,B=6,U=T=>{if(!n.current)return;const ee=k.getBoundingClientRect(),V=T.clientX-ee.left;n.current.$clickLineX=V,n.current.draw()},O=()=>{n.current&&(n.current.$clickLineX=null,n.current.draw())},F=()=>{const T=n.current;T&&(T.tooltip?.setActiveElements([],{x:0,y:0}),T.setActiveElements([]),T.update())},I=()=>{w&&(P=!0,M=!0,O(),F())},re=T=>{h.current&&(w=!0,_=T.clientX,R=T.clientY,C=!1,P=!1,M=!1,document.addEventListener("scroll",I,!0))},Z=T=>{if(!h.current||!w)return;const ee=Math.abs(T.clientX-_),V=Math.abs(T.clientY-R);if(!C&&(ee>z||V>z)){if(C=!0,V>=ee-B){P=!0,M=!0,O(),F();return}M=!0}P||U(T)},H=T=>{w&&(!P&&T&&U(T),w=!1,C=!1,P=!1,document.removeEventListener("scroll",I,!0))},te=T=>{(M||P)&&(T.preventDefault(),T.stopImmediatePropagation(),M=!1)};k.addEventListener("pointerdown",re),k.addEventListener("pointermove",Z),k.addEventListener("pointerup",H),k.addEventListener("pointerleave",H),k.addEventListener("pointercancel",H),k.addEventListener("click",te,!0);const ae=()=>{k.removeEventListener("pointerdown",re),k.removeEventListener("pointermove",Z),k.removeEventListener("pointerup",H),k.removeEventListener("pointerleave",H),k.removeEventListener("pointercancel",H),k.removeEventListener("click",te,!0),document.removeEventListener("scroll",I,!0)};n.current&&(n.current._clickLineCleanup=ae)}}catch(j){f(j.message)}})(),()=>{b=!0,n.current&&(n.current._clickLineCleanup&&n.current._clickLineCleanup(),n.current.destroy())}},[u,s,r,m,v]),t.jsxs("div",{className:"relative w-full h-[160px]",children:[o&&t.jsx("div",{className:"text-xs text-red-500",children:o}),t.jsx("canvas",{ref:i,className:"w-full h-full",style:{pointerEvents:x?"auto":"none",touchAction:"pan-y"}})]})}function br({lat:e,lon:r}){const[s,l]=d.useState(3),{data:a,loading:c,error:p}=nr(e,r,!0,s),[m,x]=d.useState(!0);if(d.useEffect(()=>{if(typeof window>"u")return;let n=!1;x(!1);const o=()=>{n||(n=!0,x(!0))},f=()=>o();window.addEventListener("pointerup",f,{once:!0}),window.addEventListener("pointercancel",f,{once:!0});const v=window.setTimeout(o,0);return()=>{window.removeEventListener("pointerup",f),window.removeEventListener("pointercancel",f),window.clearTimeout(v)}},[]),c&&!a)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("img",{src:"/logo/flocon-white.svg",alt:"",className:"loading-spinner"}),t.jsx("p",{className:"text-sm",children:"Chargement des prÃ©visions..."})]})});if(p)return t.jsx("div",{className:"text-xs text-red-600 p-4",children:p});if(!a)return null;const i=[1,3,7];return t.jsxs("div",{className:"flex flex-col gap-4 mt-1 w-full min-w-[280px]",children:[t.jsx("div",{className:"flex items-center gap-2 text-xs text-white flex-wrap mb-1",children:t.jsx("div",{className:"flex items-center gap-2",children:i.map(n=>t.jsxs("button",{onClick:()=>l(n),className:`px-2.5 py-1 rounded-full border transition-colors text-xs ${s===n?"bg-[var(--primary)] border-[var(--primary)] text-white":"bg-[var(--card-bg)] border-[var(--border)] text-[var(--text-muted)] hover:text-[var(--text-main)]"}`,children:[n," j"]},n))})}),t.jsx(dr,{data:a,days:s}),ar.map(n=>a&&a.hourly&&a.hourly.time&&a.hourly.time.length>0?t.jsxs("div",{className:"rounded-[var(--radius)] border border-[var(--border)] p-3 bg-[var(--card-bg)] shadow-[var(--shadow)]",children:[t.jsxs("div",{className:"text-xs text-white mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:n.label}),t.jsx("span",{className:"text-[var(--text-muted)]",children:n.unit})]}),t.jsx(gr,{data:a,seriesKey:n.key,color:n.color,baselineZero:n.baselineZero,tempPalette:n.tempPalette,label:n.label,unit:n.unit,days:s,interactionEnabled:m})]},n.key):null),t.jsxs("div",{className:"text-[10px] text-[var(--text-muted)] px-1 flex justify-between items-center opacity-80",children:[t.jsxs("span",{children:["Source : ",t.jsx("a",{href:"https://open-meteo.com/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors underline decoration-[var(--border)]",children:"Open-Meteo"})]}),t.jsx("span",{children:"ModÃ¨le : Mixte haute rÃ©solution"})]})]})}const De=e=>e?e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim():"",vr=e=>e.trim().replace(/\s+/g," "),wr=e=>e.postcode||e.address?.postcode,yr=e=>e.label||e.name||e.properties?.name||e.display_name?.split(",")[0]||"Lieu inconnu",he=e=>{let r=yr(e);const s=wr(e),l=e.county||e.address?.county;e.osm_key==="aerialway"&&(e.osm_value==="gondola"||e.osm_value==="cable_car"?r+=" (TÃ©lÃ©phÃ©rique)":e.osm_value==="chair_lift"&&(r+=" (TÃ©lÃ©siÃ¨ge)"));let a="";s&&s.length>=2&&(a=s.substring(0,2));const c=[r];if(l){let p=l;a&&(p+=` (${a})`),c.push(p)}else a&&c.push(`(${a})`);return c.join(", ")},Ye="https://photon.komoot.io/api/",jr=["04","05","06","38","73","74"],je={minLon:4,maxLon:8.1,minLat:42.9,maxLat:46.8},Nr=["natural:peak","natural:mountain_pass","natural:mountain_range","natural:ridge","natural:valley","natural:glacier","natural:water","natural:wood","place:city","place:town","place:village","place:hamlet","place:locality","aerialway:cable_car","aerialway:chair_lift","aerialway:gondola","landuse:winter_sports","tourism:ski_resort","leisure:sports_centre"];function it(){const[e,r]=d.useState(!1),[s,l]=d.useState(null),[a,c]=d.useState(null);d.useEffect(()=>{let i=null;try{i=new Worker(new URL("/assets/geocoding.worker-DfpwhHkO.js",import.meta.url),{type:"module"}),c(i)}catch(n){console.warn("Web Worker not available, will use main thread fallback",n),c(null)}return()=>{i&&i.terminate()}},[]);const p=d.useCallback(async i=>{const n=vr(i);if(!n||n.length<3)return[];r(!0),l(null);try{const o=new URL(Ye);o.searchParams.set("q",n),o.searchParams.set("limit","10"),o.searchParams.set("lang","fr"),Nr.forEach(b=>{o.searchParams.append("osm_tag",b)}),o.searchParams.set("lat","45.0"),o.searchParams.set("lon","6.0");const f=await fetch(o.toString());if(!f.ok)return console.error("Photon API Error",f.status),[];const v=await f.json();if(!v?.features)return[];const y=v.features.filter(b=>{const g=b.properties,j=g.postcode,N=(g.countrycode||"").toLowerCase();if(N&&N!=="fr")return!1;if(j)return jr.some(E=>j.startsWith(E));const S=b.geometry?.coordinates;if(S&&S.length===2){const[E,k]=S;return k>=je.minLat&&k<=je.maxLat&&E>=je.minLon&&E<=je.maxLon}return!1});let h=null;const u=Math.random().toString(36).substring(7);if(a)try{h=await new Promise((b,g)=>{const j=setTimeout(()=>{g(new Error("Worker timeout"))},2e3),N=S=>{S.data.requestId===u&&(clearTimeout(j),a.removeEventListener("message",N),S.data.type==="RESULTS_PROCESSED"?b(S.data.features):S.data.type==="ERROR"&&g(new Error(S.data.error)))};a.addEventListener("message",N),a.postMessage({type:"PROCESS_RESULTS",features:y,cleanQuery:n,requestId:u,limit:3})})}catch(b){console.warn("[useGeocoding] Worker failed, falling back to main thread:",b)}if(!h){const b=y.map(N=>{const S=N.properties;let E=0;S.osm_key==="natural"?S.osm_value==="peak"?E+=100:S.osm_value==="mountain_pass"?E+=80:S.osm_value==="glacier"?E+=70:S.osm_value==="mountain_range"?E+=60:E+=40:S.osm_key==="landuse"&&S.osm_value==="winter_sports"?E+=120:S.osm_key==="tourism"&&S.osm_value==="ski_resort"?E+=110:S.osm_key==="aerialway"?E+=50:S.osm_key==="place"&&(S.osm_value==="city"||S.osm_value==="town"?E+=30:S.osm_value==="village"?E+=20:E+=10);const k=n.toLowerCase(),w=(S.name||"").toLowerCase();return w===k?E+=200:w.includes(k)&&(E+=50),{feat:N,score:E}});b.sort((N,S)=>S.score-N.score);const g=new Set;h=b.filter(({feat:N})=>{const S=De(N.properties.name||"");return!S||g.has(S)?!1:(g.add(S),!0)}).slice(0,3).map(({feat:N})=>N)}return(h||[]).map(b=>{const g=b.properties,j={provider:"photon",label:g.name||g.city||"Lieu",display_name:`${g.name||""}, ${g.city||g.town||g.village||""}, ${g.country||""}`,lat:b.geometry.coordinates[1],lon:b.geometry.coordinates[0],name:g.name,postcode:g.postcode,city:g.city||g.town||g.village,country:g.country,county:g.county,state:g.state,context:g.state||g.county,osm_key:g.osm_key,osm_value:g.osm_value,extratags:{}};return j.labelFormatted=he(j),j})}catch(o){return console.error(o),l("Une erreur est survenue lors de la recherche."),[]}finally{r(!1)}},[a]),m=d.useCallback(async(i,n)=>{r(!0),l(null);try{const o=new URL(Ye.replace(/\/api\/$/,"/reverse"));o.searchParams.set("lon",n.toString()),o.searchParams.set("lat",i.toString()),o.searchParams.set("lang","fr");const f=await fetch(o.toString());if(!f.ok)return null;const v=await f.json();if(!v?.features||v.features.length===0)return null;const y=v.features[0],h=y.properties,u={provider:"photon",label:h.name||h.district||h.city||"Lieu",display_name:`${h.name||""}, ${h.city||h.town||h.village||""}, ${h.country||""}`,lat:y.geometry.coordinates[1],lon:y.geometry.coordinates[0],name:h.name,postcode:h.postcode,city:h.city||h.town||h.village,district:h.district,country:h.country,county:h.county,state:h.state,context:h.state||h.county,osm_key:h.osm_key,osm_value:h.osm_value,extratags:{}};return u.labelFormatted=he(u),u}catch(o){return console.error(o),l("Une erreur est survenue lors du gÃ©ocodage inverse."),null}finally{r(!1)}},[]),x=d.useCallback(async i=>{try{const o=`${typeof window<"u"&&window.location.hostname==="localhost"?"/api/geocoding":"https://geocoding-api.open-meteo.com/v1"}/search?name=${encodeURIComponent(i)}&count=1&language=fr`,f=await fetch(o);if(!f.ok)return null;const v=await f.json();return v.results&&v.results.length>0?v.results[0].name:null}catch(n){return console.error("Open-Meteo Search Error:",n),null}},[]);return{search:p,reverseSearch:m,openMeteoSearch:x,loading:e,error:s}}const Sr=({currentMassif:e,lat:r,lon:s,onClose:l,portalTarget:a,locationName:c})=>{const p=d.useRef(null),{reverseSearch:m}=it(),[x,i]=d.useState(c||e?.massif||"Position sÃ©lectionnÃ©e");return d.useEffect(()=>{c||m(r,s).then(n=>{n&&(n.name||n.label)&&i(n.name||n.label)})},[r,s,m,c]),d.useEffect(()=>{const n=f=>f.stopPropagation(),o=p.current;return o&&(o.addEventListener("mousedown",n),o.addEventListener("touchstart",n,{passive:!0})),()=>{o&&(o.removeEventListener("mousedown",n),o.removeEventListener("touchstart",n))}},[]),ot.createPortal(t.jsx("div",{ref:p,className:"fixed inset-0 z-[5000] flex sm:items-center sm:justify-center p-0 sm:p-4 bg-black/60 backdrop-blur-sm",onClick:n=>n.target===n.currentTarget&&l(),children:t.jsxs("div",{className:"bg-[var(--card-bg)] w-full h-full sm:h-auto sm:max-w-3xl sm:max-h-[90vh] sm:rounded-[var(--radius)] shadow-2xl border border-[var(--border)] overflow-y-auto",onClick:n=>n.stopPropagation(),onPointerDown:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between px-4 py-3 border-b border-[var(--border)] gap-3 sm:gap-0 relative",children:[t.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 pr-8 sm:pr-0",children:t.jsxs("div",{className:"text-lg font-semibold text-[var(--text-main)]",children:["PrÃ©visions - ",x]})}),t.jsx("button",{onClick:n=>{n.stopPropagation(),n.preventDefault(),l()},onPointerDown:n=>n.stopPropagation(),className:"p-2 text-[var(--text-muted)] sm:hover:text-[var(--text-main)] sm:hover:bg-[rgba(55,65,81,0.95)] active:bg-[rgba(55,65,81,0.95)] rounded-lg transition-all duration-300 ease-out absolute top-2 right-2 sm:static sm:top-auto sm:right-auto",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),t.jsx("div",{className:"p-4",children:t.jsx(br,{lat:r,lon:s})})]})}),a)},$e=({lat:e,lon:r,variant:s="default",onResult:l,initialOpenType:a,initialOpenPdf:c=!1,initialMassifCode:p,locationName:m})=>{const[x,i]=d.useState(a==="bera"||c),[n,o]=d.useState(a==="forecast"||a==="previsions"),[f,v]=d.useState(!1),[y,h]=d.useState(null),{features:u,currentMassif:b}=Gt({lat:e,lon:r,initialMassifCode:p,onResult:k=>l?.(k)});d.useEffect(()=>{const k=window.matchMedia("(max-width: 640px)"),w=_=>v(_.matches);return w(k),k.addEventListener("change",w),h(document.body),()=>k.removeEventListener("change",w)},[]);const g=d.useCallback((k,w)=>{w(!1);const _=window.location.hash.includes(`/${k}`);if(window.location.pathname.startsWith(`/${k}/`))window.location.href="/";else if(_){const C=window.location.pathname,P=window.location.search;window.history.replaceState(null,"",C+P)}typeof document<"u"&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),j=d.useMemo(()=>{if(!x||!b)return;const k=b.massif.toLowerCase().replace(/[^a-z0-9]+/g,"-");return`/r#/bera/${b.code}-${k}`},[x,!!b]);if(ze(x,()=>g("bera",i),"bera",j,a==="bera"||c),ze(n,()=>g("previsions",o),"previsions",void 0,a==="forecast"||a==="previsions"),!u)return t.jsx("div",{className:"p-4 text-gray-500 w-full",children:"Chargement des massifs..."});const N="inline-flex items-center gap-2 bg-[var(--input-bg)] border border-[var(--border)] rounded-[var(--radius)] px-2.5 sm:px-4 h-12 text-[13px] sm:text-sm font-medium text-[var(--text-main)] shadow-sm transition-all hover:border-[var(--primary)] hover:ring-1 hover:ring-[var(--primary)] focus:outline-none justify-center flex-1 min-w-0 w-full",S=t.jsxs("button",{onClick:()=>i(!0),disabled:!b,className:`${N} ${b?"":"opacity-50 cursor-not-allowed bg-gray-50 border-gray-200 text-gray-400"}`,children:[t.jsx("span",{className:"sm:hidden",children:b?"BERA":"Aucun BERA"}),t.jsx("span",{className:"hidden sm:inline",children:b?"Voir le BERA":"Aucun BERA"})]}),E=t.jsxs("button",{onClick:()=>o(!0),className:N,children:[t.jsx("span",{className:"sm:hidden",children:"PRÃ‰VISIONS"}),t.jsx("span",{className:"hidden sm:inline",children:"Voir les prÃ©visions"})]});return t.jsxs(t.Fragment,{children:[s==="inline"?t.jsxs("div",{className:"w-full grid grid-cols-2 gap-2 sm:flex sm:flex-row sm:items-center sm:gap-2",children:[S,E]}):t.jsxs("div",{className:"grid grid-cols-2 sm:inline-flex sm:flex-row items-center gap-2 bg-[var(--card-bg)] px-3 py-2 rounded-[var(--radius)] shadow-[var(--shadow)] border border-[var(--border)] mt-4 w-full",children:[S,E]}),x&&y&&b&&t.jsx(sr,{currentMassif:b,onClose:()=>g("bera",i),portalTarget:y,isMobileViewport:f,initialOpenPdf:c}),n&&y&&t.jsx(Sr,{currentMassif:b||void 0,lat:e,lon:r,onClose:()=>g("previsions",o),portalTarget:y,locationName:m})]})},kr=({isActive:e})=>t.jsx("div",{className:`orientation-lock${e?" is-active":""}`,role:"dialog","aria-modal":"true","aria-hidden":!e,"aria-label":"Mode paysage non supporte",children:t.jsxs("div",{className:"orientation-lock__card",children:[t.jsx("div",{className:"orientation-lock__title",children:"Mode paysage non supportÃ©"}),t.jsx("div",{className:"orientation-lock__text",children:"Tournez votre tÃ©lÃ©phone en mode portrait pour continuer."})]})}),_r=e=>{const r=De(he(e));if(r)return`label:${r}`;const s=De(e?.display_name),l=Number(e?.lat),a=Number(e?.lon),c=`${Number.isFinite(l)?l.toFixed(4):""},${Number.isFinite(a)?a.toFixed(4):""}`;return`fallback:${s}:${c}`},Er=Se.memo(({item:e,onClick:r,index:s})=>{const l=a=>{a.preventDefault(),r(e)};return t.jsx("li",{onMouseDown:a=>a.preventDefault(),onClick:l,className:"px-4 py-3 cursor-pointer border-b border-[var(--border)] last:border-0 hover:bg-[var(--input-bg)] transition-colors text-sm text-[var(--text-main)]",role:"button",tabIndex:0,children:e.labelFormatted||he(e)})}),Cr=Se.memo(function({query:r,onQueryChange:s,onClear:l,suggestions:a,showSuggestions:c,onSelect:p,onBlur:m,onFocus:x,loading:i,inputRef:n}){const o=d.useRef(null),f=n||o,v=d.useRef(null),y=d.useRef(!1);return d.useEffect(()=>{!r&&f.current},[r,f]),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"bg-[rgba(31,41,55,0.95)] border border-[var(--border)] rounded-[10px] shadow-[0_10px_30px_rgba(0,0,0,0.4)] backdrop-blur-sm",children:t.jsxs("div",{className:"relative flex items-center",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"absolute left-3 text-[var(--primary)] drop-shadow-[0_4px_12px_rgba(59,130,246,0.35)]",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),t.jsx("input",{type:"text",id:"massif-search-input",ref:f,value:r,onChange:h=>s(h.target.value),onFocus:x,onBlur:m,placeholder:"Entrez un lieu",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,className:"w-full bg-transparent border-0 rounded-[10px] h-10 pl-9 pr-12 py-0 text-[12px] text-[var(--text-main)] placeholder-[var(--text-main)] placeholder:opacity-80 focus:outline-none focus:ring-2 focus:ring-[var(--primary)]"}),r&&t.jsx("button",{type:"button","aria-label":"Effacer la recherche",onClick:l,className:"absolute right-2 text-[var(--text-muted)] hover:text-[var(--text-main)] focus:outline-none p-2",children:"Ã—"}),i&&t.jsx("div",{className:"absolute right-10 w-4 h-4 border-2 border-[var(--text-muted)] border-b-transparent rounded-full animate-spin"})]})}),c&&a.length>0&&t.jsx("ul",{className:"absolute left-0 right-0 top-[calc(100%-1px)] bg-[var(--card-bg)] border border-[var(--border)] rounded-[var(--radius)] shadow-[var(--shadow)] z-[1800] max-h-[240px] overflow-y-auto list-none m-0 p-0",onTouchStart:h=>{if(h.touches.length!==1)return;y.current=!1;const u=h.touches[0];v.current={x:u.clientX,y:u.clientY}},onTouchMove:h=>{if(h.touches.length!==1)return;const u=v.current;if(!u)return;const b=h.touches[0],g=Math.abs(b.clientX-u.x),j=Math.abs(b.clientY-u.y);(g>6||j>6)&&(y.current=!0)},onTouchEnd:()=>{window.setTimeout(()=>{y.current=!1,v.current=null},0)},onTouchCancel:()=>{y.current=!1,v.current=null},children:a.map((h,u)=>{const b=g=>{y.current||p(g)};return t.jsx(Er,{item:h,onClick:b,index:u},_r(h)||u)})})]})}),Lr=(e,r)=>e.query!==r.query||e.suggestions!==r.suggestions||e.showSuggestions!==r.showSuggestions?!1:e.onQueryChange===r.onQueryChange&&e.onClear===r.onClear&&e.onSelect===r.onSelect&&e.onBlur===r.onBlur&&e.onFocus===r.onFocus&&e.inputRef===r.inputRef,Rr=Se.memo(Cr,Lr);function Pr(e,r=400){const[s,l]=d.useState(e);return d.useEffect(()=>{const a=setTimeout(()=>{l(e)},r);return()=>{clearTimeout(a)}},[e,r]),s}function Mr(e,r,s,l){const[a,c]=d.useState(""),[p,m]=d.useState([]),[x,i]=d.useState(!1),[n,o]=d.useState(null),[f,v]=d.useState(!1),y=d.useRef(!1);d.useEffect(()=>{c(""),m([]),o(null)},[s]);const{search:h}=it(),u=Pr(a,500);d.useEffect(()=>{if(u.length<3){m([]),v(!1);return}if(y.current){y.current=!1;return}i(!0),h(u).then(j=>{setTimeout(()=>{m(j),v(j.length>0),o(j.length===0?"Aucune suggestion...":null)},0)}).catch(()=>o("Erreur de recherche")).finally(()=>i(!1))},[u,h]);const b=d.useCallback(j=>{y.current=!0,c(he(j)),m([]),v(!1),e(j),l.current?.blur()},[e,l]),g=d.useCallback(()=>{c(""),m([]),r()},[r]);return{localQuery:a,setLocalQuery:c,suggestions:p,loading:x,error:n,showSuggestions:f,setShowSuggestions:v,handleSelect:b,handleClear:g}}const lt=Se.memo(({onSelect:e,onClear:r,resetKey:s,searchInputRef:l,variant:a="landing"})=>{const{localQuery:c,setLocalQuery:p,suggestions:m,loading:x,error:i,showSuggestions:n,setShowSuggestions:o,handleSelect:f,handleClear:v}=Mr(e,r,s,l);return t.jsxs("div",{className:"relative w-full",children:[t.jsx(Rr,{query:c,onQueryChange:p,onClear:v,suggestions:m,showSuggestions:n&&m.length>0,onSelect:f,onBlur:()=>setTimeout(()=>o(!1),200),onFocus:()=>c.length>=3&&o(!0),loading:x,inputRef:l}),i&&a==="landing"&&t.jsx("div",{className:"absolute left-0 right-0 top-[calc(100%+8px)] z-[1800] flex justify-center",children:t.jsx("div",{className:"px-3 py-2 text-red-100 bg-red-900/80 border border-red-700/50 rounded-lg shadow-lg backdrop-blur-sm animate-in fade-in slide-in-from-top-1",children:i})})]})}),Dr=({geoResult:e,onSelect:r,onClear:s,resetKey:l,searchInputRef:a,onMassifResult:c})=>t.jsx("div",{className:"relative w-full z-[2000]",children:t.jsxs("div",{className:"w-full flex flex-col md:flex-row md:items-center gap-3 sm:gap-4 p-3 sm:p-5 rounded-[var(--radius)] bg-[radial-gradient(circle_at_20%_0%,rgba(56,189,248,0.12),transparent_52%),radial-gradient(circle_at_80%_120%,rgba(59,130,246,0.16),transparent_60%),var(--card-bg)] border border-[var(--border)]/80 shadow-[0_16px_40px_rgba(0,0,0,0.55)] ring-1 ring-[rgba(59,130,246,0.22)] backdrop-blur-sm",children:[t.jsx("div",{className:`${e?"md:w-1/2 w-full":"w-full"} `,children:t.jsx(lt,{onSelect:r,onClear:s,resetKey:l,searchInputRef:a,variant:"landing"})}),e&&c&&t.jsx("div",{className:"hidden sm:flex w-full md:w-1/2 justify-start md:justify-end items-stretch",children:t.jsx($e,{lat:e.lat,lon:e.lon,onResult:c,variant:"inline"})})]})}),$r=({onTriggerInstall:e})=>t.jsxs("div",{className:"flex flex-col flex-1 w-full items-center justify-evenly text-center gap-6 sm:gap-8",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-white",children:"Quelle zone explorer aujourd'hui ?"}),t.jsx("p",{className:"text-sm text-white/75",children:"Cherche ton point de dÃ©part."})]}),t.jsx("div",{className:"w-full flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("a",{href:"/tutoriel",className:"inline-flex p-0 bg-transparent border-0 shadow-none hover:opacity-90 transition-opacity","aria-label":"Voir le tutoriel Naivo",children:t.jsx("img",{src:"/icons/tuto.svg",alt:"Voir le tutoriel Naivo",className:"h-10 w-auto"})}),t.jsx("button",{type:"button",onClick:()=>e("install-pwa-android"),className:"p-0 bg-transparent border-0 shadow-none hover:opacity-90 transition-opacity","aria-label":"Installer Naivo sur Google Play",children:t.jsx("img",{src:"/app/googleplay.svg",alt:"Installer Naivo sur Google Play",className:"h-10 w-auto"})}),t.jsx("button",{type:"button",onClick:()=>e("install-pwa-ios"),className:"p-0 bg-transparent border-0 shadow-none hover:opacity-90 transition-opacity","aria-label":"Installer Naivo sur l'App Store",children:t.jsx("img",{src:"/app/appstore.svg",alt:"Installer Naivo sur l'App Store",className:"h-10 w-auto"})})]})})]}),Ar="modulepreload",Tr=function(e){return"/"+e},Ze={},Ir=function(r,s,l){let a=Promise.resolve();if(s&&s.length>0){let p=function(i){return Promise.all(i.map(n=>Promise.resolve(n).then(o=>({status:"fulfilled",value:o}),o=>({status:"rejected",reason:o}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),x=m?.nonce||m?.getAttribute("nonce");a=p(s.map(i=>{if(i=Tr(i),i in Ze)return;Ze[i]=!0;const n=i.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${o}`))return;const f=document.createElement("link");if(f.rel=n?"stylesheet":Ar,n||(f.as="script"),f.crossOrigin="",f.href=i,x&&f.setAttribute("nonce",x),document.head.appendChild(f),n)return new Promise((v,y)=>{f.addEventListener("load",v),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${i}`)))})}))}function c(p){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=p,window.dispatchEvent(m),!m.defaultPrevented)throw p}return a.then(p=>{for(const m of p||[])m.status==="rejected"&&c(m.reason);return r().catch(c)})};function Fr(e,r,s={}){var l=Me(e),a=Me(r),c=ve(a[1]-l[1]),p=ve(a[0]-l[0]),m=ve(l[1]),x=ve(a[1]),i=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(m)*Math.cos(x);return Pt(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),s.units)}var Ae=Fr;const zr=({lat:e,lon:r,altitude:s,radiusKm:l=5,onStationsChange:a,onLoadingChange:c})=>{const[p,m]=d.useState(null);d.useEffect(()=>{let i=!1;return c?.(!0),(async()=>{try{const o=await fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/stations/stations.geojson",{cache:"no-cache"});if(!o.ok)throw new Error(`Erreur HTTP ${o.status}`);const f=await o.json();i||m(f.features)}catch(o){console.error("Erreur lors du chargement des stations:",o),i||m([])}finally{i||c?.(!1)}})(),()=>{i=!0,c?.(!1)}},[]);const x=d.useMemo(()=>{if(!p)return[];const i=oe([r,e]);return p.map(n=>{const o=oe(n.geometry.coordinates),f=Ae(i,o,{units:"kilometers"}),v=n.properties.altitude||n.properties.alt||n.properties.elevation,y=s!==void 0&&v!==void 0?v-s:void 0,h=n.properties.geo_id_insee||n.properties.id||n.properties.code||n.properties.insee||n.properties.station_id,u=n.properties.name||n.properties.nom||n.properties.libelle||"Station inconnue",b=f<=l;return{lat:n.geometry.coordinates[1],lon:n.geometry.coordinates[0],name:u,distance:f,altitude:v,altitudeDiff:y,stationId:h,inRadius:b}})},[p,e,r,l,s]);return d.useEffect(()=>{a&&a(x)},[x,a]),null},Br="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.11.0/sql-wasm.js",Xe="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.11.0",Ur="https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//conditions/conditions.sqlite";let Ne=null;function Or(){return typeof window>"u"?Promise.resolve(null):window.initSqlJs?window.initSqlJs({locateFile:e=>`${Xe}/${e}`}):Ne||(Ne=new Promise((e,r)=>{const s=document.createElement("script");s.src=Br,s.async=!0,s.onload=()=>{window.initSqlJs?window.initSqlJs({locateFile:l=>`${Xe}/${l}`}).then(e).catch(r):r(new Error("initSqlJs non disponible"))},s.onerror=()=>r(new Error("Impossible de charger sql.js")),document.head.appendChild(s)}),Ne)}async function Wr(){const e=await Or();if(!e)return null;const s=await(await fetch(Ur,{cache:"no-cache"})).arrayBuffer();return new e.Database(new Uint8Array(s))}const qr=({lat:e,lon:r,radiusKm:s=5,referenceAltitude:l,onConditionsChange:a,onLoadingChange:c})=>{const[p,m]=d.useState([]);d.useEffect(()=>{let i=!1;return c?.(!0),(async()=>{try{const o=await Wr();if(!o)return;const f=o.prepare("SELECT * FROM conditions WHERE lat IS NOT NULL AND lon IS NOT NULL"),v=[];for(;f.step();){const y=f.getAsObject();v.push({id:Number(y.id),sortie_id:y.sortie_id!==null?Number(y.sortie_id):void 0,source_url:y.source_url,date_iso:y.date_iso,orientation:y.orientation,dif_ski:y.dif_ski,skiabilite:y.skiabilite,nom:y.nom,altitude:y.altitude!==null&&y.altitude!==void 0?Number(y.altitude):null,lat:y.lat!==null?Number(y.lat):null,lon:y.lon!==null?Number(y.lon):null,meteo_temperatures:y.meteo_temperatures,acces_parking:y.acces_parking,alt_chaussage_dechaussage:y.alt_chaussage_dechaussage,conditions_ski:y.conditions_ski,conditions_nivo_avalancheuse:y.conditions_nivo_avalancheuse,conditions_autres:y.conditions_autres})}f.free(),o.close(),i||m(v)}catch(o){console.error("Erreur lors du chargement des conditions",o),i||m([])}finally{i||c?.(!1)}})(),()=>{i=!0,c?.(!1)}},[]);const x=d.useMemo(()=>{if(!p.length)return[];const i=oe([r,e]);return p.map(n=>{if(n.lat===void 0||n.lat===null||n.lon===void 0||n.lon===null)return n;const o=oe([n.lon,n.lat]),f=Ae(i,o,{units:"kilometers"}),v=n.altitude!==null&&n.altitude!==void 0&&l!==void 0?n.altitude-l:null;return{...n,distance:f,inRadius:f<=s,altitudeDiff:v}})},[p,e,r,s,l]);return d.useEffect(()=>{a&&a(x)},[x,a]),null},Vr="https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/webcams/webcams.geojson",ue=e=>e.toString().padStart(2,"0"),Hr=e=>e.toString().padStart(3,"0"),Jr=e=>{const r=new Date(e.getFullYear(),0,1),s=e.getTime()-r.getTime();return Math.floor(s/(1e3*60*60*24))+1},Gr=(e,r,s,l,a)=>{const c=a||"Europe/Paris",p=e.toLocaleString("en-US",{timeZone:c}),m=new Date(p),x=new Date(m.getTime()+s*6e4),i=new Date(x);i.setHours(0,0,0,0);const n=(x.getTime()-i.getTime())/6e4,v=Math.floor(n/r)*r+l;return new Date(i.getTime()+v*6e4)},Qr=(e,r,s)=>{const l=r.getFullYear(),a=r.getMonth()+1,c=r.getDate(),p=r.getHours(),m=r.getMinutes(),x=r.getSeconds(),i=Jr(r),n=p%12===0?12:p%12,o=p<12?"AM":"PM",f=Math.floor(r.getTime()/1e3),v=r.toLocaleDateString(s,{weekday:"short"}),y=r.toLocaleDateString(s,{weekday:"long"}),h=r.toLocaleDateString(s,{month:"short"}),u=r.toLocaleDateString(s,{month:"long"});return e.replace(/{yyyy}/g,l.toString()).replace(/{yy}/g,l.toString().slice(-2)).replace(/{mmmm}/g,u).replace(/{mmm}/g,h).replace(/{mm}/g,ue(a)).replace(/{m}/g,a.toString()).replace(/{dd}/g,ue(c)).replace(/{d}/g,c.toString()).replace(/{eeee}/g,y).replace(/{eee}/g,v).replace(/{u}/g,((r.getDay()+6)%7+1).toString()).replace(/{ddd}/g,Hr(i)).replace(/{hh}/g,ue(p)).replace(/{h}/g,p.toString()).replace(/{kk}/g,ue(n)).replace(/{k}/g,n.toString()).replace(/{A}/g,o).replace(/{ii}/g,ue(m)).replace(/{i}/g,m.toString()).replace(/{ss}/g,ue(x)).replace(/{X}/g,f.toString())},Yr=e=>{const r=e.url_image;if(!r||typeof r!="string")return{url:void 0,imageDate:null};const s=r.trim();if(!s.includes("{"))return{url:s,imageDate:null};const l=e.periodicite??null;if(!l||l<=0)return{url:s,imageDate:null};const a=e.decalage_horloge??0,c=e.decalage_periodicite??0,p=e.fuseau_horaire??void 0,m=e.code_locale??"fr-FR",i=Gr(new Date,l,a,c,p);return{url:Qr(s,i,m),imageDate:i.toISOString()}},Zr=({lat:e,lon:r,radiusKm:s=5,referenceAltitude:l,onWebcamsChange:a,onLoadingChange:c})=>{const[p,m]=d.useState([]);d.useEffect(()=>{let i=!1;return c?.(!0),(async()=>{try{const o=await fetch(Vr,{cache:"no-cache"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const f=await o.json();i||m(f.features||[])}catch(o){console.error("Erreur lors du chargement des webcams:",o),i||m([])}finally{i||c?.(!1)}})(),()=>{i=!0,c?.(!1)}},[]);const x=d.useMemo(()=>{if(!p.length)return[];const i=oe([r,e]),n=p.map(h=>{const u=h.properties||{},b=u.statut_enligne??u.statut_en_ligne,g=typeof b=="string"?b.trim().toUpperCase():void 0,j=h.geometry?.coordinates,N=j?.[0]??u.lon,S=j?.[1]??u.lat;if(S===void 0||N===void 0)return null;const E=oe([Number(N),Number(S)]),k=Ae(i,E,{units:"kilometers"}),w=u.id,_=w!==void 0?String(w):`${N}-${S}`,R=u.name||`Webcam ${_}`,C=u.altitude??u.alt??u.elevation??u.ele??u.alt_m??u.altitude_m,P=C!=null&&C!==""?Number(C):void 0,M=P!==void 0&&l!==void 0?P-l:null,{url:z,imageDate:B}=Yr(u),U=z??(typeof u.url_image=="string"&&u.url_image.trim()!==""?u.url_image.trim():void 0),O=u.url_page,F=typeof O=="string"&&O.trim()!==""?O.trim():void 0,I=u.statut_variable,re=typeof I=="string"&&I.trim()!==""?I.trim():void 0,Z=u.largeur!==void 0&&u.largeur!==null?Number(u.largeur):null,H=u.hauteur!==void 0&&u.hauteur!==null?Number(u.hauteur):null;return{id:_,name:R,lat:Number(S),lon:Number(N),distance:k,inRadius:k<=s,altitude:P,altitudeDiff:M,imageUrl:U,imageDate:B,imagePattern:u.url_image||void 0,pageUrl:F,status:g,statusVariable:re,periodicite:u.periodicite??null,decalage_periodicite:u.decalage_periodicite??null,decalage_horloge:u.decalage_horloge??null,fuseau_horaire:u.fuseau_horaire??null,code_locale:u.code_locale??null,largeur:Z,hauteur:H}}).filter(Boolean),o=h=>{let u=0;return h.imageUrl&&(u+=2),h.pageUrl&&(u+=1),h.status&&(u+=1),h.statusVariable&&(u+=1),h.largeur&&h.hauteur&&(u+=1),u},f=h=>(h.largeur??0)*(h.hauteur??0),v=(h,u)=>{const b=f(h),g=f(u);return b!==g?b>g:o(h)>o(u)},y=new Map;return n.forEach(h=>{const u=`${h.lat.toFixed(5)}-${h.lon.toFixed(5)}`,b=y.get(u);(!b||v(h,b))&&y.set(u,h)}),Array.from(y.values())},[p,e,r,s,l]);return d.useEffect(()=>{a&&a(x)},[x,a]),null};function Ke(e,r){d.useEffect(()=>{const s=l=>{!e.current||e.current.contains(l.target)||r(l)};return document.addEventListener("mousedown",s),document.addEventListener("touchstart",s),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[e,r])}const et={center:[45.6,6.4],zoom:8.2},Xr={station:"/markers/stations.svg",condition:"/markers/avis.svg",webcam:"/markers/cams.svg"},Kr=()=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),t.jsx("polyline",{points:"2 17 12 22 22 17"}),t.jsx("polyline",{points:"2 12 12 17 22 12"})]}),es=({showStations:e,setShowStations:r,showConditions:s,setShowConditions:l,showWebcams:a,setShowWebcams:c,stationsInRadius:p,totalStations:m,avisInRadius:x,totalAvis:i,webcamsInRadius:n,totalWebcams:o,radiusKm:f,setRadiusKm:v,geoResult:y,searchInputRef:h,baseLayer:u,setBaseLayer:b,showHillshade:g,setShowHillshade:j,showContours:N,setShowContours:S,showSlopes:E,setShowSlopes:k,showSnow:w,setShowSnow:_,showSkiTraces:R,setShowSkiTraces:C,showOpenSkiMap:P,setShowOpenSkiMap:M,showPeaks:z,setShowPeaks:B,activeLat:U,activeLon:O,onGeolocate:F,isGeolocating:I,isMobile:re})=>{const[Z,H]=d.useState(!1),[te,ae]=d.useState(!1),T=d.useRef(null),ee=d.useRef(null);Ke(T,()=>ae(!1)),Ke(ee,()=>H(!1));const V=$=>`flex-1 h-11 sm:h-12 min-w-[78px] sm:min-w-[120px] px-1 sm:px-4 rounded-[var(--radius)] border transition-all duration-300 ease-out flex flex-row items-center justify-center gap-1.5 sm:gap-3 group ${$?"bg-[var(--primary)] text-white border-[var(--primary)] shadow-sm":"bg-[var(--card-bg)] border-[var(--border)] text-[var(--text-muted)] hover:border-[rgba(59,130,246,0.4)] shadow-sm opacity-70"}`,D=$=>t.jsx("span",{"aria-hidden":"true",className:"flex-none shrink-0 aspect-square flex items-center justify-center rounded-full border border-[var(--border)] bg-white/90 w-7 h-7 sm:w-8 sm:h-8 shadow-sm",children:t.jsx("img",{src:Xr[$],alt:"",className:"w-3.5 h-3.5 shrink-0 object-contain"})}),W=($,me=!1)=>`w-full flex items-center justify-between px-3 py-2 text-[13px] font-medium rounded-md transition-colors ${me?"opacity-40 pointer-events-none grayscale":$?"bg-[var(--primary)] text-white shadow-sm":"text-[var(--text-main)] hover:bg-[var(--bg-hover)]"}`;return t.jsxs("div",{className:"pointer-events-auto",children:[t.jsxs("div",{ref:T,children:[t.jsx("button",{type:"button","aria-label":"Calques de la carte",onClick:()=>ae($=>!$),className:"absolute left-3 z-[4090] h-11 w-11 rounded-[10px] bg-[rgba(31,41,55,0.95)] border border-[var(--border)] text-white shadow-[0_10px_30px_rgba(0,0,0,0.4)] backdrop-blur-sm flex items-center justify-center transition-all duration-300 ease-out sm:hover:bg-[rgba(55,65,81,0.95)] active:bg-[rgba(55,65,81,0.95)]",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 64px)"},children:t.jsx(Kr,{})}),te&&t.jsxs("div",{className:"absolute left-3 z-[4090] bg-[var(--card-bg)]/95 border border-[var(--border)] rounded-[var(--radius)] shadow-[var(--shadow)] backdrop-blur-md p-2 space-y-2",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 116px)"},children:[t.jsx("button",{type:"button","aria-pressed":g,disabled:u!=="test",onClick:()=>j($=>!$),className:W(g,u!=="test"),children:t.jsx("span",{children:"Relief"})}),t.jsx("button",{type:"button","aria-pressed":N,disabled:u!=="test",onClick:()=>S($=>!$),className:W(N,u!=="test"),children:t.jsx("span",{children:"Courbes de niveaux"})}),t.jsx("button",{type:"button","aria-pressed":E,onClick:()=>k($=>!$),className:W(E),children:t.jsx("span",{children:"Pentes"})}),t.jsx("button",{type:"button","aria-pressed":z,disabled:u!=="test",onClick:()=>B($=>!$),className:W(z,u!=="test"),children:t.jsx("span",{children:"Sommets et cols"})}),t.jsx("button",{type:"button","aria-pressed":w,onClick:()=>_($=>!$),className:W(w),children:t.jsx("span",{children:"Enneigement"})}),t.jsx("button",{type:"button","aria-pressed":R,disabled:u!=="test",onClick:()=>C($=>!$),className:W(R,u!=="test"),children:t.jsx("span",{children:"Traces de ski"})}),t.jsx("button",{type:"button","aria-pressed":P,disabled:u!=="test",onClick:()=>M($=>!$),className:W(P,u!=="test"),children:t.jsx("span",{children:"Pistes de ski"})}),t.jsx("div",{className:"border-t border-[var(--border)] border-opacity-60 my-2 mx-2"}),t.jsx("button",{type:"button","aria-pressed":u==="test",onClick:()=>b("test"),className:W(u==="test"),children:t.jsx("span",{children:"Carte naivo"})}),t.jsx("button",{type:"button","aria-pressed":u==="ign",onClick:()=>b("ign"),className:W(u==="ign"),children:t.jsx("span",{children:"Plan IGN"})}),t.jsx("button",{type:"button","aria-pressed":u==="scan25tour",onClick:()=>b("scan25tour"),className:W(u==="scan25tour"),children:t.jsx("span",{children:"Topographie IGN"})})]})]}),F&&t.jsx("button",{type:"button","aria-label":"Me localiser",onClick:F,disabled:I,className:"absolute right-3 z-[4090] h-11 w-11 rounded-[10px] bg-[rgba(31,41,55,0.95)] border border-[var(--border)] text-white shadow-[0_10px_30px_rgba(0,0,0,0.4)] backdrop-blur-sm flex items-center justify-center transition-all duration-300 ease-out sm:hover:bg-[rgba(55,65,81,0.95)] active:bg-[rgba(55,65,81,0.95)] disabled:opacity-50 active:scale-95",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 108px)"},children:I?t.jsx("img",{src:"/logo/flocon-white.svg",alt:"",className:"w-5 h-5 animate-spin"}):t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"12",cy:"12",r:"3"}),t.jsx("path",{d:"M12 2v3m0 14v3M2 12h3m14 0h3"}),t.jsx("circle",{cx:"12",cy:"12",r:"7"})]})}),t.jsxs("div",{ref:ee,children:[t.jsx("button",{type:"button","aria-label":Z?"Masquer le menu":"Afficher le menu",onClick:()=>H($=>!$),className:"absolute left-3 bottom-3 z-[4101] h-11 w-11 rounded-[10px] bg-[rgba(31,41,55,0.95)] border border-[var(--border)] text-white shadow-[0_10px_30px_rgba(0,0,0,0.4)] backdrop-blur-sm flex items-center justify-center transition-all duration-300 ease-out sm:hover:bg-[rgba(55,65,81,0.95)] active:bg-[rgba(55,65,81,0.95)] active:scale-95",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"4",y1:"7",x2:"20",y2:"7"}),t.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),t.jsx("line",{x1:"4",y1:"17",x2:"20",y2:"17"})]})}),Z&&t.jsxs("div",{className:"absolute left-3 right-3 sm:right-auto sm:w-[450px] bottom-16 z-[4100] bg-[var(--card-bg)]/95 border border-[var(--border)] rounded-[var(--radius)] shadow-[var(--shadow)] backdrop-blur-md p-3 space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px] sm:text-[11px]",children:[t.jsxs("button",{type:"button","aria-pressed":e,onClick:()=>r($=>!$),className:V(e),children:[D("station"),t.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[y&&t.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[p,"/",m]}),t.jsx("span",{children:"Stations"})]})]}),t.jsxs("button",{type:"button","aria-pressed":s,onClick:()=>l($=>!$),className:V(s),children:[D("condition"),t.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[y&&t.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[x,"/",i]}),t.jsx("span",{children:"Retours terrain"})]})]}),t.jsxs("button",{type:"button","aria-pressed":a,onClick:()=>c($=>!$),className:V(a),children:[D("webcam"),t.jsxs("span",{className:"flex flex-col leading-tight text-center sm:flex-col sm:leading-tight min-w-0 flex-1",children:[y&&t.jsxs("span",{className:"font-mono",style:{fontVariantNumeric:"tabular-nums"},children:[n,"/",o]}),t.jsx("span",{children:"Webcams"})]})]})]}),y&&t.jsxs("div",{className:"bg-[var(--input-bg)]/90 border border-[var(--border)] rounded-[var(--radius)] shadow-sm p-3 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between text-[12px] font-medium text-[var(--text-main)]",children:[t.jsx("span",{children:"Rayon"}),t.jsxs("span",{className:"px-2 py-1 rounded-[var(--radius)] bg-[var(--card-bg)] border border-[var(--border)] text-[11px]",children:[f," km"]})]}),t.jsx("input",{type:"range",min:"0",max:"50",step:"5",value:f,disabled:!y,onChange:$=>{v(Number($.target.value)),h.current?.blur()},onPointerDown:()=>h.current?.blur(),onTouchStart:()=>h.current?.blur(),"aria-label":"Rayon en kilometres",className:"h-2 w-full bg-[var(--card-bg)] border-[var(--border)] rounded-lg appearance-none cursor-pointer accent-[var(--text-main)]"})]}),t.jsx("div",{className:"pt-1",children:t.jsx($e,{lat:U,lon:O,variant:"inline",locationName:y?.label})})]})]})]})},ts=()=>t.jsxs("div",{className:"absolute left-[calc(env(safe-area-inset-left,0px)+16px)] z-[1200] bg-[rgba(31,41,55,0.95)] backdrop-blur-sm border border-[var(--border)] rounded-[10px] p-2 shadow-[0_10px_30px_rgba(0,0,0,0.4)] flex flex-col gap-2 min-w-[110px] sm:min-w-[130px] animate-[slideDown_0.3s_ease-out] pointer-events-auto",style:{top:"calc(env(safe-area-inset-top, 0px) + 72px)"},children:[t.jsx("div",{className:"flex items-center justify-between gap-2 mb-0.5 px-0.5",children:t.jsx("p",{className:"text-[9px] font-bold text-[var(--text-muted)] uppercase tracking-wider",children:"Inclinaison"})}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-sm border border-white/10",style:{backgroundColor:"#ffff00"}}),t.jsx("span",{className:"text-[11px] font-medium text-[var(--text-main)]",children:"30Â° - 35Â°"})]}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-sm border border-white/10",style:{backgroundColor:"#ffa500"}}),t.jsx("span",{className:"text-[11px] font-medium text-[var(--text-main)]",children:"35Â° - 40Â°"})]}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-sm border border-white/10",style:{backgroundColor:"#ff0000"}}),t.jsx("span",{className:"text-[11px] font-medium text-[var(--text-main)]",children:"40Â° - 45Â°"})]}),t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"w-3 h-3 rounded-sm border border-white/10",style:{backgroundColor:"#800080"}}),t.jsx("span",{className:"text-[11px] font-medium text-[var(--text-main)]",children:"> 45Â°"})]}),t.jsx("div",{className:"mt-1 pt-2 border-t border-white/10 space-y-1.5 max-w-[130px]",children:t.jsxs("p",{className:"text-[8px] leading-[1.3] text-[var(--text-muted)] italic",children:["naivo est fourni Ã  titre informatif et sans garantie dâ€™exhaustivitÃ© ni dâ€™exactitude. ",t.jsx("a",{href:"/cgu",target:"_blank",className:"text-blue-400 hover:underline font-medium not-italic",children:"Voir les CGU"}),"."]})})]}),rs=()=>{const[e,r]=d.useState(null);if(d.useEffect(()=>{fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data/tiles/snow_legend.json").then(c=>c.json()).then(c=>r(c)).catch(c=>console.error("[SnowLegend] Failed to load data:",c))},[]),!e)return null;const s=e.ramp.findIndex(c=>c.value>e.max_snow_cm),a=[...s===-1?e.ramp:e.ramp.slice(0,s+1)].reverse();return t.jsxs("div",{className:"absolute right-[calc(env(safe-area-inset-right,0px)+16px)] z-[1200] bg-[rgba(31,41,55,0.95)] backdrop-blur-sm border border-[var(--border)] rounded-[10px] p-2 shadow-[0_10px_30px_rgba(0,0,0,0.4)] flex flex-col gap-2 min-w-[110px] sm:min-w-[130px] animate-[slideDown_0.3s_ease-out] text-white pointer-events-auto",style:{top:"calc(env(safe-area-inset-top, 0px) + 72px)"},children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5 px-0.5",children:[t.jsxs("p",{className:"text-[9px] font-bold text-[var(--text-muted)] uppercase tracking-wider",children:["Enneigement",t.jsx("br",{}),"naturel"]}),t.jsx("span",{className:"px-1 py-0.5 bg-blue-500/20 text-blue-400 text-[7px] font-black uppercase tracking-tighter rounded-sm border border-blue-500/30",children:"Beta"})]}),t.jsx("div",{className:"flex flex-col gap-1.5",children:a.map((c,p)=>{const m=`rgba(${c.r}, ${c.g}, ${c.b}, ${c.a/255})`,x=p===0;return t.jsxs("div",{className:"flex items-center gap-2.5 px-0.5",children:[t.jsx("div",{className:"w-3.5 h-3.5 rounded-sm shadow-inner ring-1 ring-white/10",style:{backgroundColor:m}}),t.jsx("div",{className:"flex flex-col justify-center",children:t.jsx("span",{className:"text-[11px] font-medium leading-tight",children:x?`> ${c.value}`:c.value})})]},p)})}),t.jsx("div",{className:"mt-1 pt-2 border-t border-white/10 space-y-1.5 max-w-[130px]",children:t.jsxs("p",{className:"text-[8px] leading-[1.3] text-[var(--text-muted)] italic",children:["naivo est fourni Ã  titre informatif et sans garantie dâ€™exhaustivitÃ© ni dâ€™exactitude. ",t.jsx("a",{href:"/cgu",target:"_blank",className:"text-blue-400 hover:underline font-medium not-italic",children:"Voir les CGU"}),"."]})})]})},ss=d.lazy(()=>Ir(()=>import("./MiniMap.C0a7F4iE.js"),__vite__mapDeps([0,1,2,3]))),Le={center:[45.6,6.4],zoom:8.2},ns=({geoResult:e,mapCenter:r,mobileDefaultView:s,urlZoom:l,initialDeepLink:a,setInitialDeepLink:c,baseLayer:p,setBaseLayer:m,showHillshade:x,setShowHillshade:i,showContours:n,setShowContours:o,showSlopes:f,setShowSlopes:v,showSnow:y,setShowSnow:h,showSkiTraces:u,setShowSkiTraces:b,showOpenSkiMap:g,setShowOpenSkiMap:j,showPeaks:N,setShowPeaks:S,showStations:E,setShowStations:k,showConditions:w,setShowConditions:_,showWebcams:R,setShowWebcams:C,showPointer:P,filteredStations:M,setFilteredStations:z,conditions:B,setConditions:U,conditionGroups:O,webcams:F,setWebcams:I,loadingAltitude:re,loadingStations:Z,setLoadingStations:H,loadingAvis:te,setLoadingAvis:ae,loadingWebcams:T,setLoadingWebcams:ee,radiusKm:V,setRadiusKm:D,selectLocation:W,clearSearch:$,searchResetKey:me,searchInputRef:ge,handleMapViewChange:be,onMapInstanceReady:ie,onGeolocate:ke,isGeolocating:_e,isMobile:Te,isMounted:le})=>{const se=e?.lat??s?.center[0]??r?.[0]??Le.center[0],L=e?.lon??s?.center[1]??r?.[1]??Le.center[1],A=e?.altitude,J=e?{center:[e.lat,e.lon],zoom:l||12}:s??{center:[se,L],zoom:Le.zoom},q=e?V:1e3;e?.lat??r?.[0],e?.lon??r?.[1];const Q=[];Z&&Q.push("Stations"),te&&Q.push("Avis"),T&&Q.push("Webcams");const K=!!e&&Q.length>0,dt=M.filter(fe=>fe.inRadius).length,ut=M.length,mt=B.filter(fe=>fe.inRadius).length,ft=B.length,pt=F.filter(fe=>fe.inRadius).length,ht=F.length;return t.jsxs("div",{className:"space-y-3 sm:space-y-4 animate-[slideUp_0.3s_ease-out] w-full flex-1 min-h-0 flex flex-col",children:[t.jsx("div",{className:"flex-none sm:flex-1 min-h-0 flex",children:t.jsxs("div",{className:"relative w-full h-[100svh] rounded-none overflow-hidden border-0",children:[le&&t.jsx(d.Suspense,{fallback:t.jsx("div",{className:"w-full h-full bg-gray-100 animate-pulse"}),children:t.jsx(ss,{lat:se,lon:L,stations:E?M:[],conditions:w?O:[],webcams:R?F:[],radiusKm:q,initialView:J,showReference:!!e&&P,baseLayer:p,onBaseLayerChange:m,onViewChange:be,onMapInstanceReady:ie,enableHillshade:x,enableContours:n,enableSlopes:f,enableSnow:y,enableSkiTraces:u,enableOpenSkiMap:g,enablePeaks:N,initialSelectedId:a?.id,initialSelectedType:a?.type==="stations"?"station":a?.type==="webcams"?"webcam":a?.type==="avis"?"condition":void 0,onSelectionClear:()=>{(window.location.pathname!=="/"||window.location.search)&&window.history.pushState(null,"","/"),c(null)},topLeftOverlay:t.jsx(lt,{onSelect:W,onClear:$,resetKey:me,searchInputRef:ge,variant:"overlay"})},e?`${e.lat}-${e.lon}`:"default")}),K&&t.jsx("div",{className:"absolute inset-0 z-[4095] flex items-center justify-center pointer-events-none",children:t.jsx("div",{className:"bg-black/70 backdrop-blur-md border border-white/10 rounded-[var(--radius)] px-6 py-5 shadow-[0_20px_60px_rgba(0,0,0,0.65)]",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("img",{src:"/logo/flocon-white.svg",alt:"",className:"loading-spinner",style:{width:40,height:40}}),t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("p",{className:"text-sm font-medium text-white",children:"Chargementâ€¦"}),t.jsx("p",{className:"text-xs text-white/75",children:Q.join(" Â· ")})]})]})})}),t.jsx(es,{showStations:E,setShowStations:k,showConditions:w,setShowConditions:_,showWebcams:R,setShowWebcams:C,stationsInRadius:dt,totalStations:ut,avisInRadius:mt,totalAvis:ft,webcamsInRadius:pt,totalWebcams:ht,radiusKm:V,setRadiusKm:D,geoResult:e,searchInputRef:ge,baseLayer:p,setBaseLayer:m,showHillshade:x,setShowHillshade:i,showContours:n,setShowContours:o,showSlopes:f,setShowSlopes:v,showSnow:y,setShowSnow:h,showSkiTraces:u,setShowSkiTraces:b,showOpenSkiMap:g,setShowOpenSkiMap:j,showPeaks:N,setShowPeaks:S,activeLat:se,activeLon:L,onGeolocate:ke,isGeolocating:_e,isMobile:Te}),f&&t.jsx(ts,{}),y&&t.jsx(rs,{})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(zr,{lat:se,lon:L,radiusKm:q,altitude:A,onStationsChange:z,onLoadingChange:H}),t.jsx(qr,{lat:se,lon:L,radiusKm:q,referenceAltitude:A,onConditionsChange:U,onLoadingChange:ae}),t.jsx(Zr,{lat:se,lon:L,radiusKm:q,referenceAltitude:A,onWebcamsChange:I,onLoadingChange:ee})]})]})},as=({isActive:e})=>{const[r,s]=d.useState(!1),[l,a]=d.useState(!0),[c,p]=d.useState(!0);d.useEffect(()=>{if(!e||new URLSearchParams(window.location.search).get("cgu")==="false")return;if(!localStorage.getItem("naivo_disclaimer_accepted")){const n=setTimeout(()=>{s(!0)},500);return()=>clearTimeout(n)}},[e]);const m=()=>{l&&(localStorage.setItem("naivo_disclaimer_accepted","true"),c?gt():bt(),s(!1))};return r?t.jsxs("div",{className:"fixed inset-0 z-[4000] flex items-center justify-center p-6 sm:p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-[#050712]/80 backdrop-blur-md animate-in fade-in duration-500",onClick:()=>l&&m()}),t.jsx("div",{className:"relative bg-[#111827] border border-[#272b3f] rounded-[24px] p-8 sm:p-10 max-w-sm w-full shadow-[0_32px_64px_rgba(0,0,0,0.6)] animate-in zoom-in-95 fade-in duration-300 pointer-events-auto",children:t.jsxs("div",{className:"flex flex-col items-center gap-6 text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center border border-blue-500/20",children:t.jsx("svg",{className:"w-8 h-8 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:"Bienvenue sur naivo"}),t.jsxs("p",{className:"text-[15px] sm:text-base text-[#9ca3c4] leading-relaxed",children:[t.jsx("strong",{children:"naivo"})," agrÃ¨ge des donnÃ©es issues de sources tierces Ã  titre informatif et ne se substitue en aucun cas Ã  votre jugement sur le terrain."]})]}),t.jsxs("div",{className:"w-full space-y-4",children:[t.jsxs("div",{className:"flex flex-col gap-3 text-left",children:[t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:l,onChange:x=>a(x.target.checked),className:"mt-1 w-4 h-4 rounded border-[#272b3f] bg-[#050712] text-blue-600 focus:ring-blue-500 focus:ring-offset-0"}),t.jsxs("span",{className:"text-sm text-[#9ca3c4] group-hover:text-white transition-colors",children:["J'accepte les ",t.jsx("a",{href:"/cgu",target:"_blank",className:"text-blue-500 hover:underline",children:"Conditions GÃ©nÃ©rales dâ€™Utilisation"})," et reconnais demeurer seul responsable de mes dÃ©cisions et de leur mise en Å“uvre."]})]}),t.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",checked:c,onChange:x=>p(x.target.checked),className:"mt-1 w-4 h-4 rounded border-[#272b3f] bg-[#050712] text-blue-600 focus:ring-blue-500 focus:ring-offset-0"}),t.jsx("span",{className:"text-sm text-[#9ca3c4] group-hover:text-white transition-colors",children:"J'accepte les cookies analytiques pour aider Ã  amÃ©liorer le service."})]})]}),t.jsx("button",{onClick:m,disabled:!l,className:`w-full font-bold py-4 rounded-[18px] transition-all active:scale-95 shadow-xl ${l?"bg-blue-600 hover:bg-blue-500 text-white shadow-blue-600/20":"bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:"Voir la carte"})]})]})})]}):null},ct="naivo:lastMapView",Re=e=>typeof e=="number"&&Number.isFinite(e),Pe=(e,r,s)=>Math.min(s,Math.max(r,e));function os(e=ct){if(typeof window>"u")return null;try{const r=window.localStorage.getItem(e);if(!r)return null;const s=JSON.parse(r);if(!s||typeof s!="object")return null;const l=s,a=l.center,c=l.zoom;if(!Array.isArray(a)||a.length!==2)return null;const p=a[0],m=a[1];return!Re(p)||!Re(m)||!Re(c)?null:{center:[Pe(p,-90,90),Pe(m,-180,180)],zoom:Pe(c,0,22)}}catch{return null}}function hs(e,r=ct){if(!(typeof window>"u"))try{const s={center:[Number(e.center[0].toFixed(6)),Number(e.center[1].toFixed(6))],zoom:Number(e.zoom.toFixed(2))};window.localStorage.setItem(r,JSON.stringify(s))}catch{}}function is(e,r){const[s,l]=d.useState(r),[a,c]=d.useState(!1),[p,m]=d.useState(r?et:null);return d.useEffect(()=>{if(typeof window>"u")return;const x=window.matchMedia("(max-width: 768px)"),i=()=>{const n=x.matches;l(n),n&&!e?m(os()??et):n||m(null)};return i(),x.addEventListener("change",i),()=>x.removeEventListener("change",i)},[e]),d.useEffect(()=>{if(typeof window>"u")return;const x=window.matchMedia("(orientation: landscape)"),i=window.matchMedia("(pointer: coarse)"),n=()=>{const o=x.matches&&i.matches;c(o),document.body.classList.toggle("orientation-locked",o)};return n(),x.addEventListener("change",n),i.addEventListener("change",n),window.addEventListener("resize",n),()=>{x.removeEventListener("change",n),i.removeEventListener("change",n),window.removeEventListener("resize",n),document.body.classList.remove("orientation-locked")}},[]),{isMobile:s,showOrientationLock:a,mobileDefaultView:p}}function ls(e){const[r,s]=d.useState(null),l=d.useRef(null),[a,c]=d.useState(null),[p,m]=d.useState("test"),[x,i]=d.useState(!1),[n,o]=d.useState(!0),[f,v]=d.useState(!1),[y,h]=d.useState(!1),[u,b]=d.useState(!1),[g,j]=d.useState(!1),[N,S]=d.useState(!1),[E,k]=d.useState(!0);d.useEffect(()=>{if(e){l.current=[e.lat,e.lon];return}const _=l.current;_&&(l.current=_,s(R=>R&&Math.abs(R[0]-_[0])<1e-5&&Math.abs(R[1]-_[1])<1e-5?R:_))},[e]),d.useEffect(()=>{p!=="test"&&(i(!1),o(!1),v(!1),j(!1),k(!1))},[p]);const w=d.useCallback(_=>{l.current=_.center},[]);return{mapCenter:r,setMapCenter:s,mapCenterRef:l,urlZoom:a,setUrlZoom:c,baseLayer:p,setBaseLayer:m,showLayerControls:x,setShowLayerControls:i,showHillshade:n,setShowHillshade:o,showContours:f,setShowContours:v,showSlopes:y,setShowSlopes:h,showSnow:u,setShowSnow:b,showSkiTraces:g,setShowSkiTraces:j,showOpenSkiMap:N,setShowOpenSkiMap:S,showPeaks:E,setShowPeaks:k,handleMapViewChange:w}}function tt(e){return String(e||"").trim().replace(/^0+/,"")}function cs(e,r,s){try{if(!e||typeof e.queryTerrainElevation!="function")return;const l=e.queryTerrainElevation([s,r]);if(typeof l=="number"&&Number.isFinite(l))return Math.round(l)}catch(l){console.debug("Terrain elevation not available:",l)}}async function ds(e,r,s=1e4){try{const l=new AbortController,a=setTimeout(()=>l.abort(),s),c=`https://api.open-elevation.com/api/v1/lookup?locations=${e},${r}`,p=await fetch(c,{method:"GET",headers:{Accept:"application/json"},signal:l.signal});if(clearTimeout(a),p.ok){const m=await p.json();if(m.results&&m.results.length>0&&m.results[0].elevation)return Math.round(m.results[0].elevation)}}catch(l){l.name==="AbortError"?console.debug("Elevation API request timed out"):console.error("Erreur lors de la rÃ©cupÃ©ration de l'altitude :",l)}}async function rt(e,r,s){if(s){const l=cs(s,e,r);if(l!==void 0)return l}return await ds(e,r)}function us(e){const r=new Map;return e.forEach(s=>{if(s.lat===void 0||s.lat===null||s.lon===void 0||s.lon===null)return;const l=`${s.lat.toFixed(5)}-${s.lon.toFixed(5)}`,a=r.get(l)||{lat:s.lat,lon:s.lon,distance:s.distance,inRadius:s.inRadius,entries:[]};a.entries.push(s),s.distance!==void 0&&(a.distance=s.distance),s.inRadius!==void 0&&(a.inRadius=s.inRadius),r.set(l,a)}),Array.from(r.values())}function ms(e,r,s,l,a,c,p,m,x,i,n,o,f,v,y,h){const[u,b]=d.useState(null);return d.useEffect(()=>{if(typeof window>"u")return;const g=new URLSearchParams(window.location.search),j=g.get("ll"),N=g.get("z"),S=g.get("map"),E=g.get("ol"),k=g.get("mk"),w=g.get("pointer");if(g.has("mk")&&v(!0),w==="off"&&y(!1),j){const[C,P]=j.split(",").map(Number);!isNaN(C)&&!isNaN(P)&&e({lat:C,lon:P})}if(N){const C=Number(N);isNaN(C)||r(C)}if(S!==null&&(S==="base"?s("test"):S==="ign"?s("ign"):S==="scan25tour"&&s("scan25tour")),E!==null){const C=E.split(",").filter(Boolean),P=C.includes("relief"),M=C.includes("courbes"),z=C.includes("pentes"),B=C.includes("neige"),U=C.includes("ski"),O=C.includes("ski_osm"),F=C.includes("sommets");l(P),a(M),c(z),p(B),m(U),x(O),i(F)}else l(!0),a(!1),c(!1),p(!1),m(!1),x(!1),i(!0);if(k!==null){const C=k.split(",").filter(Boolean);n(C.includes("stations")),o(C.includes("avis")),f(C.includes("cams"))}else n(!0),o(!0),f(!0);let R=window.location.pathname.split("/").filter(Boolean);if(R.length>0&&R[0]==="r"&&window.location.hash.length>1){const P=window.location.hash.substring(1).replace(/^\//,"").split("/").filter(Boolean);P.length>=2&&(R=P)}if(R.length>=2){let C=R[0].toLowerCase();const M=R[1].split("-")[0];if(["webcam","webcams","cam","cams"].includes(C)?C="webcams":[" station","stations"].includes(C)?C="stations":["avis","condition","conditions"].includes(C)&&(C="avis"),["stations","webcams","avis","bera"].includes(C)&&M){const z=R[2]==="pdf";b({type:C,id:M,subtype:z?"pdf":void 0}),(async()=>{try{if(C==="stations"){const F=(await(await fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/stations/stations.geojson")).json()).features.find(I=>String(I.properties.geo_id_insee||I.properties.id||I.properties.code||I.properties.insee||I.properties.station_id)===M);F&&(e({lat:F.geometry.coordinates[1],lon:F.geometry.coordinates[0]}),r(10))}else if(C==="webcams"){const F=(await(await fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data//metadonnees/webcams/webcams.geojson")).json()).features.find(I=>String(I.properties.id)===M);F&&(e({lat:F.geometry.coordinates[1],lon:F.geometry.coordinates[0]}),r(10))}else if(C==="bera"){const F=(await(await fetch("https://raw.githubusercontent.com/NCSdecoopman/naivo-data/master/data/metadonnees/massifs/massifs.geojson")).json()).features.find(I=>tt(I.properties.code)===tt(M));if(F){const I=F.geometry.type==="Polygon"?F.geometry.coordinates[0][0]:F.geometry.coordinates[0][0][0];e({lat:I[1],lon:I[0]}),r(10)}}}catch(U){console.warn("Failed to fetch coords for deep link",U)}})()}}},[]),d.useEffect(()=>{if(u?.type==="avis"&&h.length>0){const g=h.find(j=>String(j.id)===u.id);g&&(e({lat:Number(g.lat),lon:Number(g.lon)}),r(10))}},[h,u]),{initialDeepLink:u,setInitialDeepLink:b}}function xs({forceMobile:e=!1}){const[,r]=d.useTransition(),[s,l]=d.useState(!1),a=d.useRef(null),c=d.useRef(null),p=d.useRef(null),[m,x]=d.useState(0),[i,n]=d.useState(null),[o,f]=d.useState(null),[v,y]=d.useState(8),[h,u]=d.useState(!1),[b,g]=d.useState([]),[j,N]=d.useState([]),[S,E]=d.useState([]),[k,w]=d.useState(!1),[_,R]=d.useState(!1),[C,P]=d.useState(!1),[M,z]=d.useState(!1),[B,U]=d.useState(!1),[O,F]=d.useState(()=>{if(typeof window>"u")return!0;const L=new URLSearchParams(window.location.search).get("mk");return L?L.includes("stations"):!0}),[I,re]=d.useState(()=>{if(typeof window>"u")return!0;const L=new URLSearchParams(window.location.search).get("mk");return L?L.includes("avis"):!0}),[Z,H]=d.useState(()=>{if(typeof window>"u")return!0;const L=new URLSearchParams(window.location.search).get("mk");return L?L.includes("webcams")||L.includes("cams"):!0}),[te,ae]=d.useState(()=>typeof window>"u"?!0:new URLSearchParams(window.location.search).get("pointer")!=="off"),{isMobile:T,showOrientationLock:ee,mobileDefaultView:V}=is(!!i,e),D=ls(i),{initialDeepLink:W,setInitialDeepLink:$}=ms(n,D.setUrlZoom,D.setBaseLayer,D.setShowHillshade,D.setShowContours,D.setShowSlopes,D.setShowSnow,D.setShowSkiTraces,D.setShowOpenSkiMap,D.setShowPeaks,F,re,H,u,ae,j),me=d.useMemo(()=>us(j),[j]);d.useEffect(()=>{l(!0)},[]),d.useEffect(()=>{if(typeof document>"u")return;const L=document.body;if(!L)return;const A=!!(i||T||h||W);return L.classList.toggle("has-query",A),L.classList.toggle("has-map",!!(i||T&&V||h||W)),()=>{L.classList.remove("has-map"),L.classList.remove("has-query")}},[i,T,V,h,W]),d.useEffect(()=>{if(typeof window>"u")return;const L=new URLSearchParams(window.location.search),A=[];if(O&&A.push("stations"),I&&A.push("avis"),Z&&A.push("cams"),O&&I&&Z){if(L.has("mk")){L.delete("mk");const q=L.toString(),Q=window.location.pathname+(q?"?"+q:"");window.history.replaceState(null,"",Q)}}else{const q=A.join(",");if(L.get("mk")!==q){q?L.set("mk",q):L.set("mk","");const Q=L.toString(),K=window.location.pathname+(Q?"?"+Q:"");window.history.replaceState(null,"",K)}}},[O,I,Z]),d.useEffect(()=>{if(typeof window>"u")return;const L=new URLSearchParams(window.location.search);D.baseLayer==="test"?L.delete("map"):D.baseLayer==="ign"?L.set("map","ign"):D.baseLayer==="scan25tour"&&L.set("map","scan25tour");const A=[];D.showHillshade&&A.push("relief"),D.showContours&&A.push("courbes"),D.showSlopes&&A.push("pentes"),D.showSnow&&A.push("neige"),D.showSkiTraces&&A.push("ski"),D.showOpenSkiMap&&A.push("ski_osm"),D.showPeaks&&A.push("sommets");const J=A.join(",");J==="relief,sommets"?L.delete("ol"):L.set("ol",J),te?L.delete("pointer"):L.set("pointer","off");const q=L.toString(),Q=window.location.search.replace("?","");if(q!==Q){const K=window.location.pathname+(q?"?"+q:"");window.history.replaceState(null,"",K)}},[D.baseLayer,D.showHillshade,D.showContours,D.showSlopes,D.showSnow,D.showSkiTraces,D.showPeaks,te]);const ge=d.useCallback(L=>{const A=document.getElementById(L);A&&(A.dispatchEvent(new MouseEvent("click",{bubbles:!0})),setTimeout(()=>a.current?.focus(),150))},[]),be=d.useCallback(()=>{x(L=>L+1),f(null),n(null),g([]),N([]),E([]),setTimeout(()=>a.current?.focus(),100)},[]),ie=d.useCallback(async L=>{const A=L.lat,J=L.lon;if(!Number.isFinite(A)||!Number.isFinite(J))return;let q=L.extratags?.ele?parseFloat(L.extratags.ele):void 0;if(Number.isNaN(q)&&(q=void 0),r(()=>{n({lat:A,lon:J,altitude:q,label:L.label||L.display_name}),$(null)}),setTimeout(()=>{c.current?.scrollIntoView({behavior:"smooth",block:"start"})},100),q===void 0){w(!0);try{const Q=await rt(A,J,p.current);Q!==void 0&&r(()=>{n(K=>!K||K.lat!==A||K.lon!==J?K:{...K,altitude:Q})})}finally{w(!1)}}},[]),ke=d.useCallback(()=>{if(!navigator.geolocation){alert("La gÃ©olocalisation n'est pas supportÃ©e par votre navigateur.");return}U(!0),navigator.geolocation.getCurrentPosition(L=>{const{latitude:A,longitude:J}=L.coords;ie({lat:A,lon:J,display_name:"Ma position",provider:"photon",label:"Ma position"}),U(!1)},L=>{console.error("Erreur de gÃ©olocalisation:",L),U(!1);let A="Impossible de rÃ©cupÃ©rer votre position.";L.code===L.PERMISSION_DENIED&&(A="AccÃ¨s Ã  la position refusÃ©."),alert(A)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},[ie]),_e=d.useCallback(L=>{f(L?`${L.massif} (${L.departement}, ${L.insee})`:null)},[]),le=!!(i||T&&(V||e))||!!W||h,se=!!(T&&!i&&(V||e));return t.jsxs("div",{className:`w-full flex flex-col h-full min-h-0 relative ${le?"max-w-none px-0":"max-w-4xl mx-auto px-1 sm:px-6"} `,children:[t.jsx(kr,{isActive:ee}),t.jsx(as,{isActive:le}),!le&&t.jsxs("div",{className:"pt-8 sm:pt-12 pb-4 sm:pb-6 flex-1 flex flex-col gap-4 sm:gap-6",children:[t.jsx(Dr,{geoResult:i,onSelect:ie,onClear:be,resetKey:m,searchInputRef:a,onMassifResult:_e}),!i&&!se&&t.jsx($r,{onTriggerInstall:ge})]}),le&&t.jsx(ns,{geoResult:i,mapCenter:D.mapCenter,mobileDefaultView:V,urlZoom:D.urlZoom,initialDeepLink:W,setInitialDeepLink:$,baseLayer:D.baseLayer,setBaseLayer:D.setBaseLayer,showHillshade:D.showHillshade,setShowHillshade:D.setShowHillshade,showContours:D.showContours,setShowContours:D.setShowContours,showSlopes:D.showSlopes,setShowSlopes:D.setShowSlopes,showSnow:D.showSnow,setShowSnow:D.setShowSnow,showSkiTraces:D.showSkiTraces,setShowSkiTraces:D.setShowSkiTraces,showOpenSkiMap:D.showOpenSkiMap,setShowOpenSkiMap:D.setShowOpenSkiMap,showPeaks:D.showPeaks,setShowPeaks:D.setShowPeaks,showStations:O,setShowStations:F,showConditions:I,setShowConditions:re,showWebcams:Z,setShowWebcams:H,showPointer:te,filteredStations:b,setFilteredStations:g,conditions:j,setConditions:N,conditionGroups:me,webcams:S,setWebcams:E,loadingAltitude:k,loadingStations:_,setLoadingStations:R,loadingAvis:C,setLoadingAvis:P,loadingWebcams:M,setLoadingWebcams:z,radiusKm:v,setRadiusKm:y,selectLocation:ie,clearSearch:be,searchResetKey:m,searchInputRef:a,handleMapViewChange:D.handleMapViewChange,onMapInstanceReady:L=>{p.current=L,i&&i.altitude===void 0&&setTimeout(async()=>{const A=await rt(i.lat,i.lon,L);A!==void 0&&r(()=>{n(J=>J&&{...J,altitude:A})})},500)},onGeolocate:ke,isGeolocating:B,isMobile:T,isMounted:s}),W&&W.type==="bera"&&t.jsx("div",{className:"hidden",children:t.jsx($e,{lat:i?.lat??0,lon:i?.lon??0,initialOpenType:"bera",initialMassifCode:W.id,variant:"inline"})})]})}export{xs as M,Ir as _,Qr as a,os as b,Gr as c,ze as d,rt as f,t as j,ot as r,Ke as u,hs as w};
