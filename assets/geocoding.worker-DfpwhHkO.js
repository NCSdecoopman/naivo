(function(){"use strict";function l(t){return t?t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim():""}function u(t,o){return t.map(n=>{const e=n.properties;let s=0;e.osm_key==="natural"?e.osm_value==="peak"?s+=100:e.osm_value==="mountain_pass"?s+=80:e.osm_value==="glacier"?s+=70:e.osm_value==="mountain_range"?s+=60:s+=40:e.osm_key==="aerialway"?s+=50:e.osm_key==="place"&&(e.osm_value==="city"||e.osm_value==="town"?s+=30:e.osm_value==="village"?s+=20:s+=10);const a=o.toLowerCase(),r=(e.name||"").toLowerCase();return r===a?s+=200:r.includes(a)&&(s+=50),{feat:n,score:s}})}function c(t){const o=new Set;return t.filter(({feat:n})=>{const e=l(n.properties.name||"");return!e||o.has(e)?!1:(o.add(e),!0)})}self.onmessage=t=>{const{type:o,features:n,cleanQuery:e,limit:s,requestId:a}=t.data;if(o==="PROCESS_RESULTS")try{const r=u(n,e);r.sort((i,f)=>f.score-i.score);const m=c(r).slice(0,s).map(({feat:i})=>i);self.postMessage({type:"RESULTS_PROCESSED",features:m,requestId:a})}catch(r){console.error("[Worker] Error processing results:",r),self.postMessage({type:"ERROR",error:r instanceof Error?r.message:"Unknown error",requestId:a})}}})();
